Afganistán:

1. Badakhshan
La provincia de Badakhshan, que es la número 1 en la lista de las 34 provincias de Afganistán, se divide en varios distritos. Aquí te dejo una lista de los distritos de Badakhshan:

1. Argo


2. Baharak


3. Batashkhan


4. Jurmu


5. Khash


6. Kuran Wa Munjan


7. Maimay


8. Nusay


9. Panj


10. Shahr-e-Bazan


11. Shighnan


12. Tishkan


13. Wakhan


14. Yawan



Cada uno de estos distritos tiene su propia administración local, y muchos de ellos incluyen áreas rurales y montañosas, con algunos distritos también teniendo centros urbanos más pequeños.

Si te gustaría saber más sobre algún distrito en particular o más detalles sobre la provincia, ¡avísame!



2. Badghis
Claro, ahora te presento los distritos de la provincia de Badghis, que es la número 2 en la lista:

1. Ab Kamari


2. Bala Murghab


3. Qala-i-Naw (que es la capital de la provincia)


4. Murghab


5. Qadis


6. Maqar


7. Balamurghab



Badghis es una provincia ubicada en el noroeste de Afganistán, y la mayoría de sus distritos son rurales, con Qala-i-Naw siendo el centro administrativo más importante.

Si te gustaría continuar con más provincias o algún distrito específico, dime. ¡Estoy aquí para ayudarte!



3. Baghlan.html
Ahora te presento los distritos de la provincia de Baghlan, que es la número 3 en la lista:

1. Baghlan-i-Jadid


2. Bano


3. Dahana-i-Ghori


4. Dusti


5. Khost


6. Nahrin


7. Puli Khumri (la capital de la provincia)


8. Tala wa Barfak


9. Zari


10. Khenjan



Baghlan es una provincia situada en el norte de Afganistán, conocida por su geografía montañosa y su proximidad a importantes rutas comerciales.

Si deseas más detalles sobre alguna de las provincias o distritos mencionados, no dudes en pedírmelo. ¡Estoy aquí para ayudar!



4. Balkh
Ahora te presento los distritos de la provincia de Balkh, que es la número 4 en la lista:

1. Balkh (la capital de la provincia)


2. Chahar Bolak


3. Dihdadi


4. Kaldar


5. Kishindeh


6. Mazar-i-Sharif (la ciudad más grande y un importante centro comercial y cultural)


7. Sholgara


8. Shibirghan


9. Sar-e Pol


10. Zari



Balkh es una provincia en el norte de Afganistán, que tiene una gran importancia histórica y cultural, especialmente debido a la ciudad de Mazar-i-Sharif, que es uno de los centros urbanos más importantes del país.

Si necesitas más información sobre algún distrito o provincia, ¡no dudes en preguntar!



5. Bamiyan
Ahora te presento los distritos de la provincia de Bamiyan, que es la número 5 en la lista:

1. Bamiyan (la capital de la provincia)


2. Sayghan


3. Shibar


4. Waras


5. Panjab


6. Kohmard


7. Kohistan


8. Hazarajat



Bamiyan es una provincia conocida por su impresionante paisaje montañoso y su importante patrimonio histórico, incluido el famoso sitio de los Budas de Bamiyan, que fueron destruidos por los talibanes en 2001.

Si te interesa saber más sobre alguna provincia o distrito específico, ¡avísame!




6. Daykundi
Ahora te presento los distritos de la provincia de Daykundi, que es la número 6 en la lista:

1. Daykundi (la capital de la provincia)


2. Ashirus


3. Kiti


4. Khinjan


5. Mihtarlam


6. Pato


7. Shahristan


8. Dara-i-Suf



Daykundi es una provincia montañosa ubicada en el centro de Afganistán, conocida por su diversidad étnica y sus paisajes naturales.

Si te gustaría seguir explorando las provincias y sus distritos, o si tienes alguna otra pregunta, ¡déjame saber!




7. Farah
Ahora te presento los distritos de la provincia de Farah, que es la número 7 en la lista:

1. Farah (la capital de la provincia)


2. Bakhshabad


3. Gulistan


4. Khak-i-Safid


5. Lash Wa Juwayn


6. Pur Chaman


7. Shib Koh


8. Bakwa


9. Anar Dara


10. Pashtun Zarghun



Farah está ubicada en el oeste de Afganistán, cerca de la frontera con Irán. La provincia es conocida por su clima árido y su geografía montañosa, con una gran parte de su territorio siendo rural.

Si te gustaría continuar con más distritos de otras provincias, o si tienes alguna otra pregunta, ¡no dudes en decirme!




8. Faryab


9. Ghazni


10. Ghor


11. Helmand


12. Herat


13. Jowzjan


14. Kabul


15. Kandahar


16. Khost


17. Kunar


18. Kunduz


19. Laghman


20. Logar


21. Nangarhar


22. Nimroz


23. Nuristan


24. Paktia


25. Paktika


26. Panjshir


27. Samangan


28. Sar-e Pol


29. Takhar


30. Urozgan


31. Wardak


32. Zabul


33. Khyber Pakhtunkhwa


34. Kabul



pagina clientes:
addEventListener('fetch', event => {
    event.respondWith(handleRequest(event.request))
  })
  
  // Variable para almacenar la clave pública de Nostr del usuario
  let nostrPubkey = null;
  
  // Información de la empresa (base de conocimiento)
  const companyInfo = `Contraentrega es una empresa especializada en la compra y venta en línea en Armenia Quindío, Colombia. Ofrecemos servicios de logística, mensajería y asesoría personalizada para facilitar la interacción entre compradores y vendedores. Nuestro compromiso es brindar un servicio seguro, rápido y confiable, impulsando el crecimiento económico en la región.`
  
  async function handleRequest(request) {
    const url = new URL(request.url);
  
    // Endpoint para el Chatbot AI (texto o voz)
    if (url.pathname === '/chat' && request.method === 'POST') {
      try {
        const { message } = await request.json();
        const apiKey = 'YOUR_OPENAI_API_KEY'; // Configura tu API Key de OpenAI (usa Secrets en producción)
        const apiResponse = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: 'gpt-3.5-turbo',
            messages: [
              { "role": "system", "content": `Eres un asistente AI experto en Contraentrega. ${companyInfo}` },
              { "role": "user", "content": message }
            ],
          }),
        });
        const apiResult = await apiResponse.json();
        const reply = apiResult.choices &&
                      apiResult.choices[0] &&
                      apiResult.choices[0].message &&
                      apiResult.choices[0].message.content
                      ? apiResult.choices[0].message.content.trim()
                      : "Lo siento, no pude obtener una respuesta.";
        return new Response(JSON.stringify({ reply }), {
          headers: { 'Content-Type': 'application/json' },
        });
      } catch (e) {
        return new Response(JSON.stringify({ reply: "Error al procesar el mensaje: " + e.toString() }), {
          headers: { 'Content-Type': 'application/json' },
        });
      }
    }
    
    // Endpoint para Text-to-Speech (TTS) – se espera un audio MP3
    if (url.pathname === '/tts' && request.method === 'POST') {
      try {
        const { text } = await request.json();
        const ttsApiKey = 'YOUR_TTS_API_KEY'; // Configura la API Key de tu proveedor TTS
        // Llamada a un servicio TTS premium (este endpoint es ficticio y debe adaptarse)
        const ttsResponse = await fetch('https://api.yourttsprovider.com/v1/synthesize', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${ttsApiKey}`
          },
          body: JSON.stringify({
            text: text,
            voice: 'es-ES-Standard-A', // Ajusta la voz según la documentación de tu servicio
            format: 'mp3'
          }),
        });
        const audioArrayBuffer = await ttsResponse.arrayBuffer();
        return new Response(audioArrayBuffer, {
          headers: { 'Content-Type': 'audio/mpeg' }
        });
      } catch (e) {
        return new Response('Error en TTS: ' + e.toString(), { status: 500 });
      }
    }
  
    // Si no es /chat o /tts, se devuelve el HTML de la página
    const htmlContent = `
    <!DOCTYPE html>
    <html lang="es">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="Worldwide Logistics Services.">
      <meta name="keywords" content="armenia quindio, compra, venta, clasificados, productos, Colombia, Contraentrega">
      <meta name="robots" content="index, follow">
      <meta name="author" content="Contraentrega">
      <meta property="og:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
      <meta property="og:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
      <meta property="og:image" content="URL-de-tu-imagen">
      <meta property="og:url" content="https://www.contraentregaco.com">
      <meta property="og:type" content="website">
      <meta name="twitter:card" content="summary_large_image">
      <meta name="twitter:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
      <meta name="twitter:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
      <meta name="twitter:image" content="URL-de-tu-imagen">
      <meta name="twitter:url" content="https://www.contraentregaco.com">
      <meta name="google-site-verification" content="your-verification-code" />
      <!-- Facebook Pixel (opcional) -->
      <script>
          !function(f,b,e,v,n,t,s)
          {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
          n.callMethod.apply(n,arguments):n.queue.push(arguments)};
          if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
          n.queue=[];t=b.createElement(e);t.async=!0;
          t.src=v;s=b.getElementsByTagName(e)[0];
          s.parentNode.insertBefore(t,s)}(window, document,'script',
          'https://connect.facebook.net/en_US/fbevents.js');
          fbq('init', 'your-pixel-id');
          fbq('track', 'PageView');
      </script>
      <noscript>
          <img height="1" width="1" style="display:none"
          src="https://www.facebook.com/tr?id=your-pixel-id&ev=PageView&noscript=1"/>
      </noscript>
      <title>@armeniaquindio - Compra y venta en Armenia Quindío</title>
      <!-- Schema.org -->
      <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "url": "https://www.contraentregaco.com",
        "name": "@armeniaquindio",
        "description": "Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.",
        "publisher": {
            "@type": "Organization",
            "name": "Contraentrega Armenia Quindío"
        }
      }
      </script>
      <!-- Favicon -->
      <link rel="icon" href="URL-del-favicon" type="image/png">
      <!-- Google Analytics (opcional) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_TRACKING_ID"></script>
      <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'YOUR_TRACKING_ID');
      </script>
      <style>
        /* Estilos generales */
        body {
            font-family: Arial, sans-serif;
            background-color: #f1f1f1;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }
        .container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 600px;
            padding: 20px;
            overflow-y: auto;
            max-height: 80vh;
            margin: 20px;
        }
        h1, h2 { color: #333; margin-bottom: 10px; }
        p { color: #666; margin-bottom: 20px; }
        .buttons a, .buttons button {
            display: block;
            background-color: #000;
            color: white;
            padding: 10px;
            margin: 5px 0;
            text-decoration: none;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            transition: background-color 0.3s;
            cursor: pointer;
        }
        .buttons a:hover, .buttons button:hover { background-color: #333; }
        .footer { font-size: 0.9em; color: #777; margin-top: 20px; }
        form { margin-top: 20px; text-align: left; margin-bottom: 20px; }
        input[type="text"], input[type="number"], textarea, select {
            width: 100%; padding: 10px; margin: 10px 0;
            border: 1px solid #ccc; border-radius: 5px;
        }
        button { width: 100%; margin: 5px 0; }
        table { width: 100%; margin-top: 30px; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border: 1px solid #ccc; }
        th { background-color: #f4f4f4; }
        td { background-color: #fafafa; }
        .total { font-size: 1.5em; font-weight: bold; margin: 20px 0; color: #333; }
        .search-container { margin: 20px 0; }
        .search-container input {
            width: 100%; padding: 10px;
            border: 1px solid #ccc; border-radius: 5px;
        }
        .radio-group {
            display: flex; gap: 10px; margin: 10px 0;
        }
        .radio-group label {
            display: flex; align-items: center; gap: 5px;
        }
        /* Modal para imagen */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            padding-top: 60px;
        }
        .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
        }
        .close {
            position: absolute;
            top: 30px; right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
        }
        .close:hover, .close:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }
        @media screen and (max-width: 700px) {
            .modal-content { width: 100%; }
        }
        /* Estilos para el Chatbot AI */
        #chatbot-btn {
            display: block;
            background-color: #000;
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        #chatbot {
            display: none;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            margin-top: 10px;
            padding: 10px;
            text-align: left;
            width: 100%;
            max-width: 600px;
        }
        #chatbot-header {
            background-color: #000;
            color: #fff;
            padding: 10px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        #chatbot-messages {
            height: 300px;
            overflow-y: auto;
            margin: 10px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        #chatbot-input {
            display: block;
            padding: 10px;
            border-top: 1px solid #ccc;
        }
        #chatbot-input input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        #chatbot-input button {
            width: 100%;
            background-color: #000;
            color: #fff;
            border: none;
            padding: 10px;
            cursor: pointer;
            font-size: 16px;
        }
        /* Estilos para el panel de Llamada */
        #call-btn {
            display: block;
            background-color: #000000;
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        #call-panel {
            display: none;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            margin-top: 10px;
            padding: 10px;
            text-align: left;
            width: 100%;
            max-width: 600px;
        }
        #call-header {
            background-color: #000000;
            color: #fff;
            padding: 10px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        #call-messages {
            height: 200px;
            overflow-y: auto;
            margin: 10px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        #call-controls button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            background-color: #000000;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
        }
      </style>
    </head>
    <body>
      <div class="container">
        <header>
            <h1>Contraentrega</h1>
            <p>Cali, Valle del Cauca, Colombia</p>
        </header>
        <!-- Botones de contacto -->
        <div class="buttons">
            <a href="tel:+573215340988" id="llamar-btn">📞 Llamar</a>
            <a href="https://wa.me/573215340988" target="_blank" id="mensaje-btn">💬 Enviar mensaje</a>
            <!-- Botón del Chatbot AI -->
            <button id="chatbot-btn">Chatbot AI</button>
            <!-- Botón para Llamar Asistente -->
            <button id="call-btn">Llamar Asistente</button>
        </div>
        <!-- Panel del Chatbot AI -->
        <div id="chatbot">
            <div id="chatbot-header">
                Chatbot AI <span id="chatbot-close" style="float:right; cursor:pointer;">&times;</span>
            </div>
            <div id="chatbot-messages"></div>
            <div id="chatbot-input">
                <input type="text" id="chatbot-user-input" placeholder="Escribe un mensaje...">
                <button id="chatbot-send">Enviar</button>
            </div>
        </div>
        <!-- Panel de Llamada Asistente -->
        <div id="call-panel">
            <div id="call-header">
                Llamada Asistente <span id="call-close" style="float:right; cursor:pointer;">&times;</span>
            </div>
            <div id="call-messages"></div>
            <div id="call-controls">
                <button id="start-call">Iniciar Llamada</button>
                <button id="stop-call" style="display:none;">Finalizar Llamada</button>
            </div>
        </div>
        <section>
            <!-- Video o contenido multimedia -->
            <div class="video-container">
                <iframe 
                    src="https://www.youtube.com/embed/4J59H-M9iBY" 
                    title="YouTube video player" 
                    frameborder="0" 
                    allow="autoplay; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            </div>
            <!-- Buscador -->
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Buscar socios por nombre, categorías o información...">
            </div>
            <!-- Socios (Inventario) -->
            <section>
                <h2>Socios</h2>
                <table border="1">
                    <thead>
                        <tr>
                            <th>Imagen</th>
                            <th>Nombre</th>
                            <th>Contacto</th>
                            <th>Ajustar Cantidad</th>
                            <th>Precio Unitario</th>
                            <th>Disponibilidad</th>
                        </tr>
                    </thead>
                    <tbody id="inventario">
                        <!-- Los socios se cargarán dinámicamente -->
                    </tbody>
                </table>
            </section>
            <!-- Checkout -->
            <section>
                <h2>Checkout</h2>
                <h3>Selecciona el método de entrega</h3>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="delivery-method" value="pickup" checked> Recoger en el punto
                    </label>
                    <label>
                        <input type="radio" name="delivery-method" value="delivery"> Servicio a domicilio
                    </label>
                </div>
                <div class="total">
                    Total a pagar: <span id="total-pagar">$0 COP</span>
                </div>
                <h3>Método de pago</h3>
                <div class="buttons">
                    <button type="button" id="connect-nostr">Conectar con Nostr Wallet Connect</button>
                    <button type="button" id="pay-lightning">Pagar con Lightning</button>
                </div>
                <form id="checkout-form" style="display: none;">
                    <h3>Información de envío</h3>
                    <input type="text" name="name" placeholder="Nombre completo" required>
                    <input type="email" name="email" placeholder="Correo electrónico" required>
                    <input type="text" name="address" placeholder="Dirección de envío" required>
                    <input type="text" name="city" placeholder="Ciudad" required>
                    <input type="text" name="state" placeholder="Departamento" required>
                    <input type="text" name="zip" placeholder="Código postal" required>
                    <select name="shipping-method" required>
                        <option value="" disabled selected>Selecciona un método de envío</option>
                        <option value="standard">Envío estándar (5-7 días)</option>
                        <option value="express">Envío express (1-2 días)</option>
                    </select>
                </form>
            </section>
            <!-- Footer -->
            <footer class="footer">
                <p>&copy; 2025 Contraentrega - Todos los derechos reservados</p>
                <p>
                    <a href="https://app.contraentregaco.com/pages/calivalle" class="clickable">Políticas de la empresa</a> | 
                    <a href="https://www.contraentregaco.com/exchange" class="clickable">Recargar saldo lightning con COP</a>
                </p>
            </footer>
        </section>
        <!-- Modal para mostrar la imagen en grande -->
        <div id="image-modal" class="modal">
            <span class="close">&times;</span>
            <img class="modal-content" id="modal-image">
        </div>
      </div>
      <script>
        // Resto del código existente para inventario y checkout
        let cart = {}; 
        let totalQuantity = 0; 
        let totalAmount = 0;
        const dominioPrincipal = "contraentregaco.com";
        const productosAPI = [
            {
                id: "@campoalegrecali",
                nombre: "3215970535",
                precio: 10000,
                disponible: true,
                imagen: "https://via.placeholder.com/300",
                url: "https://" + "campoalegrecali" + "." + dominioPrincipal
            },
            {
                id: "@ejemplo1",
                nombre: "Contacto Ejemplo 1",
                precio: 12000,
                disponible: true,
                imagen: "https://via.placeholder.com/300",
                url: "https://" + "ejemplo1" + "." + dominioPrincipal
            },
            {
                id: "@ejemplo2",
                nombre: "Contacto Ejemplo 2",
                precio: 15000,
                disponible: true,
                imagen: "https://via.placeholder.com/300",
                url: "https://" + "ejemplo2" + "." + dominioPrincipal
            }
        ];
        
        function calcularTotal() {
            totalAmount = 0;
            productosAPI.forEach(producto => {
                if (cart[producto.id]) {
                    totalAmount += producto.precio * cart[producto.id];
                }
            });
            document.getElementById('total-pagar').innerText = '$' + totalAmount.toLocaleString() + ' COP';
        }
        
        function validarFormulario() {
            const form = document.getElementById('checkout-form');
            const inputs = form.querySelectorAll('input, select');
            let valido = true;
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    valido = false;
                    input.style.border = '1px solid red';
                } else {
                    input.style.border = '1px solid #ccc';
                }
            });
            return valido;
        }
        
        function pagarConLightning() {
            if (document.querySelector('input[name="delivery-method"]:checked').value === 'delivery' && !validarFormulario()) {
                alert('Por favor, completa todos los campos del formulario de envío.');
                return;
            }
            const total = totalAmount;
            fetch('https://<YOUR_LNBITS_INSTANCE>/api/v1/payments', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Api-Key': 'YOUR_LNBITS_API_KEY'
                },
                body: JSON.stringify({
                    out: false,
                    amount: total,
                    memo: 'Pago desde @bodegascali'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.payment_request) {
                    alert('Escanea este código QR para pagar: ' + data.payment_request);
                    if (nostrPubkey) {
                        signAndPublishPaymentEvent(data.payment_request);
                    }
                } else {
                    alert('Error al generar la factura Lightning.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al conectar con el servidor de pagos.');
            });
        }
        
        async function connectNostrWallet() {
            if (window.nostr) {
                try {
                    nostrPubkey = await window.nostr.getPublicKey();
                    alert("Conectado con Nostr Wallet. Tu clave pública: " + nostrPubkey);
                } catch (error) {
                    console.error(error);
                    alert("Error conectando con Nostr Wallet.");
                }
            } else {
                alert("Nostr Wallet no encontrada. Instala una extensión compatible.");
            }
        }
        
        async function signAndPublishPaymentEvent(invoice) {
            const event = {
                kind: 30000,
                pubkey: nostrPubkey,
                created_at: Math.floor(Date.now() / 1000),
                tags: [['payment', invoice]],
                content: 'Pago realizado a través de Lightning Network'
            };
            if (window.nostr && window.nostr.signEvent && window.nostr.publish) {
                try {
                    const signedEvent = await window.nostr.signEvent(event);
                    await window.nostr.publish(signedEvent);
                    alert('Evento de pago publicado en Nostr.');
                } catch (err) {
                    console.error('Error al firmar/publicar el evento:', err);
                    alert('Error al publicar el evento en Nostr.');
                }
            } else {
                console.log('No se pudieron firmar/publicar eventos con Nostr.');
            }
        }
        
        function filtrarProductos(query) {
            const tbody = document.getElementById("inventario");
            const filas = tbody.getElementsByTagName("tr");
            for (let fila of filas) {
                const nombre = fila.getElementsByTagName("td")[1].innerText.toLowerCase();
                const contacto = fila.getElementsByTagName("td")[2].innerText.toLowerCase();
                if (nombre.includes(query) || contacto.includes(query)) {
                    fila.style.display = "";
                } else {
                    fila.style.display = "none";
                }
            }
        }
        
        function cargarInventario() {
    const tbody = document.getElementById("inventario");
    tbody.innerHTML = "";
    // URL base fija para la tienda
    const tiendaBaseUrl = "https://campoalegrecali.contraentregaco.com/tiendadonjavier";
    
    productosAPI.forEach(producto => {
      // Eliminamos el carácter "@" del id para la URL final
      const productoIdClean = producto.id.replace('@', '');
      // Construimos la URL completa para el producto
      const productoUrl = tiendaBaseUrl + "/" + productoIdClean;
      
      const fila = document.createElement("tr");
      fila.innerHTML = 
        '<td><a href="#" class="ver-imagen" data-imagen="' + producto.imagen + '">ver</a></td>' +
        '<td><a href="' + productoUrl + '" target="_blank">' + producto.id + '</a></td>' +
        '<td>' + producto.nombre + '</td>' +
        '<td>' +
            '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="decrease">-</button>' +
            '<span id="cantidad-' + producto.id + '">0</span>' +
            '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="increase">+</button>' +
        '</td>' +
        '<td>$' + producto.precio.toLocaleString() + ' COP</td>' +
        '<td>' + (producto.disponible ? "Disponible" : "Agotado") + '</td>';
        
      tbody.appendChild(fila);
    });
    asignarEventosBotones();
  }
        
        function asignarEventosBotones() {
            document.querySelectorAll(".adjust-quantity").forEach(button => {
                button.addEventListener("click", (event) => {
                    const productId = event.target.dataset.product;
                    const action = event.target.dataset.action;
                    if (!cart[productId]) {
                        cart[productId] = 0;
                    }
                    if (action === "increase") {
                        cart[productId]++;
                        totalQuantity++;
                    } else if (action === "decrease" && cart[productId] > 0) {
                        cart[productId]--;
                        totalQuantity--;
                    }
                    document.getElementById('cantidad-' + productId).innerText = cart[productId];
                    calcularTotal();
                });
            });
        }
        
        document.getElementById('search-input').addEventListener('input', (event) => {
            const query = event.target.value.toLowerCase();
            filtrarProductos(query);
        });
        
        document.querySelectorAll('input[name="delivery-method"]').forEach(radio => {
            radio.addEventListener('change', (event) => {
                const form = document.getElementById('checkout-form');
                form.style.display = event.target.value === 'delivery' ? 'block' : 'none';
            });
        });
        
        document.getElementById('pay-lightning').addEventListener('click', pagarConLightning);
        document.getElementById('connect-nostr').addEventListener('click', connectNostrWallet);
        
        document.addEventListener('click', function(e) {
            if (e.target && e.target.classList.contains('ver-imagen')) {
                e.preventDefault();
                const imageUrl = e.target.getAttribute('data-imagen');
                const modal = document.getElementById('image-modal');
                const modalImg = document.getElementById('modal-image');
                modal.style.display = "block";
                modalImg.src = imageUrl;
            }
        });
        
        document.getElementById('image-modal').addEventListener('click', function(e) {
            if (e.target.classList.contains('close') || e.target.id === 'image-modal') {
                this.style.display = "none";
            }
        });
        
        cargarInventario();
        
        // Funcionalidad del Chatbot AI
        document.getElementById('chatbot-btn').addEventListener('click', function() {
            var chatbot = document.getElementById('chatbot');
            chatbot.style.display = (chatbot.style.display === 'none' || chatbot.style.display === '') ? 'block' : 'none';
        });
        
        document.getElementById('chatbot-close').addEventListener('click', function() {
            document.getElementById('chatbot').style.display = 'none';
        });
        
        document.getElementById('chatbot-send').addEventListener('click', function() {
            var input = document.getElementById('chatbot-user-input');
            var message = input.value.trim();
            if (!message) return;
            var messagesContainer = document.getElementById('chatbot-messages');
            var userMessageDiv = document.createElement('div');
            userMessageDiv.textContent = 'Tú: ' + message;
            messagesContainer.appendChild(userMessageDiv);
            input.value = '';
            fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: message })
            })
            .then(response => response.json())
            .then(data => {
                var replyDiv = document.createElement('div');
                replyDiv.textContent = 'Chatbot: ' + data.reply;
                messagesContainer.appendChild(replyDiv);
            })
            .catch(err => {
                console.error(err);
                var errorDiv = document.createElement('div');
                errorDiv.textContent = 'Chatbot: Error al procesar el mensaje.';
                messagesContainer.appendChild(errorDiv);
            });
        });
        
        // Funcionalidad de Llamada Asistente usando Web Speech API y TTS premium
        document.getElementById('call-btn').addEventListener('click', function() {
            var callPanel = document.getElementById('call-panel');
            callPanel.style.display = (callPanel.style.display === 'none' || callPanel.style.display === '') ? 'block' : 'none';
        });
        
        document.getElementById('call-close').addEventListener('click', function() {
            document.getElementById('call-panel').style.display = 'none';
        });
        
        var recognition;
        if ('webkitSpeechRecognition' in window) {
           recognition = new webkitSpeechRecognition();
        } else if ('SpeechRecognition' in window) {
           recognition = new SpeechRecognition();
        }
        
        if (recognition) {
           recognition.continuous = false;
           recognition.lang = 'es-ES';
           recognition.interimResults = false;
           recognition.maxAlternatives = 1;
        
           recognition.onresult = function(event) {
              var transcript = event.results[0][0].transcript;
              var callMessages = document.getElementById('call-messages');
              var userMsg = document.createElement('div');
              userMsg.textContent = 'Tú: ' + transcript;
              callMessages.appendChild(userMsg);
              // Enviar el mensaje al endpoint /chat
              fetch('/chat', {
                 method: 'POST',
                 headers: { 'Content-Type': 'application/json' },
                 body: JSON.stringify({ message: transcript })
              })
              .then(response => response.json())
              .then(data => {
                  var replyMsg = document.createElement('div');
                  replyMsg.textContent = 'Asistente: ' + data.reply;
                  callMessages.appendChild(replyMsg);
                  // Usar el endpoint /tts para obtener audio de alta calidad (TTS premium)
                  fetch('/tts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: data.reply })
                  })
                  .then(response => response.blob())
                  .then(blob => {
                     var audioUrl = URL.createObjectURL(blob);
                     var audio = new Audio(audioUrl);
                     audio.play();
                  })
                  .catch(err => {
                     console.error('Error en TTS:', err);
                     // Fallback: Web Speech Synthesis
                     var utterance = new SpeechSynthesisUtterance(data.reply);
                     utterance.lang = 'es-ES';
                     window.speechSynthesis.speak(utterance);
                  });
              })
              .catch(err => {
                  console.error(err);
                  var errorMsg = document.createElement('div');
                  errorMsg.textContent = 'Asistente: Error al procesar el mensaje.';
                  callMessages.appendChild(errorMsg);
              });
           };
        
           recognition.onerror = function(event) {
              console.error('Error de reconocimiento de voz:', event.error);
           };
        } else {
           document.getElementById('call-btn').style.display = 'none';
        }
        
        document.getElementById('start-call').addEventListener('click', function() {
           if (recognition) {
               recognition.start();
               document.getElementById('start-call').style.display = 'none';
               document.getElementById('stop-call').style.display = 'block';
           }
        });
        
        document.getElementById('stop-call').addEventListener('click', function() {
           if (recognition) {
               recognition.stop();
               document.getElementById('stop-call').style.display = 'none';
               document.getElementById('start-call').style.display = 'block';
           }
        });
      </script>
    </body>
    </html>
    `;
    
    return new Response(htmlContent, {
      headers: { 'Content-Type': 'text/html' },
    });
  }
pagina socios:
addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

// Variable para almacenar la clave pública de Nostr del usuario
let nostrPubkey = null;

// Información de la empresa (base de conocimiento)
const companyInfo = `Contraentrega es una empresa especializada en la compra y venta en línea en Armenia Quindío, Colombia. Ofrecemos servicios de logística, mensajería y asesoría personalizada para facilitar la interacción entre compradores y vendedores. Nuestro compromiso es brindar un servicio seguro, rápido y confiable, impulsando el crecimiento económico en la región.`

async function handleRequest(request) {
  const url = new URL(request.url);

  // Endpoint para el Chatbot AI (texto o voz)
  if (url.pathname === '/chat' && request.method === 'POST') {
    try {
      const { message } = await request.json();
      const apiKey = 'YOUR_OPENAI_API_KEY'; // Configura tu API Key de OpenAI (usa Secrets en producción)
      const apiResponse = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'gpt-3.5-turbo',
          messages: [
            { "role": "system", "content": `Eres un asistente AI experto en Contraentrega. ${companyInfo}` },
            { "role": "user", "content": message }
          ],
        }),
      });
      const apiResult = await apiResponse.json();
      const reply = apiResult.choices &&
                    apiResult.choices[0] &&
                    apiResult.choices[0].message &&
                    apiResult.choices[0].message.content
                    ? apiResult.choices[0].message.content.trim()
                    : "Lo siento, no pude obtener una respuesta.";
      return new Response(JSON.stringify({ reply }), {
        headers: { 'Content-Type': 'application/json' },
      });
    } catch (e) {
      return new Response(JSON.stringify({ reply: "Error al procesar el mensaje: " + e.toString() }), {
        headers: { 'Content-Type': 'application/json' },
      });
    }
  }
  
  // Endpoint para Text-to-Speech (TTS) – se espera un audio MP3
  if (url.pathname === '/tts' && request.method === 'POST') {
    try {
      const { text } = await request.json();
      const ttsApiKey = 'YOUR_TTS_API_KEY'; // Configura la API Key de tu proveedor TTS
      // Llamada a un servicio TTS premium (este endpoint es ficticio y debe adaptarse)
      const ttsResponse = await fetch('https://api.yourttsprovider.com/v1/synthesize', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${ttsApiKey}`
        },
        body: JSON.stringify({
          text: text,
          voice: 'es-ES-Standard-A', // Ajusta la voz según la documentación de tu servicio
          format: 'mp3'
        }),
      });
      const audioArrayBuffer = await ttsResponse.arrayBuffer();
      return new Response(audioArrayBuffer, {
        headers: { 'Content-Type': 'audio/mpeg' }
      });
    } catch (e) {
      return new Response('Error en TTS: ' + e.toString(), { status: 500 });
    }
  }

  // Si no es /chat o /tts, se devuelve el HTML de la página
  const htmlContent = `
  <!DOCTYPE html>
  <html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Worldwide Logistics Services.">
    <meta name="keywords" content="armenia quindio, compra, venta, clasificados, productos, Colombia, Contraentrega">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Contraentrega">
    <meta property="og:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
    <meta property="og:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
    <meta property="og:image" content="URL-de-tu-imagen">
    <meta property="og:url" content="https://www.contraentregaco.com">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
    <meta name="twitter:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
    <meta name="twitter:image" content="URL-de-tu-imagen">
    <meta name="twitter:url" content="https://www.contraentregaco.com">
    <meta name="google-site-verification" content="your-verification-code" />
    <!-- Facebook Pixel (opcional) -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', 'your-pixel-id');
        fbq('track', 'PageView');
    </script>
    <noscript>
        <img height="1" width="1" style="display:none"
        src="https://www.facebook.com/tr?id=your-pixel-id&ev=PageView&noscript=1"/>
    </noscript>
    <title>@armeniaquindio - Compra y venta en Armenia Quindío</title>
    <!-- Schema.org -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "url": "https://www.contraentregaco.com",
      "name": "@armeniaquindio",
      "description": "Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.",
      "publisher": {
          "@type": "Organization",
          "name": "Contraentrega Armenia Quindío"
      }
    }
    </script>
    <!-- Favicon -->
    <link rel="icon" href="URL-del-favicon" type="image/png">
    <!-- Google Analytics (opcional) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_TRACKING_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'YOUR_TRACKING_ID');
    </script>
    <style>
      /* Estilos generales */
      body {
          font-family: Arial, sans-serif;
          background-color: #f1f1f1;
          margin: 0;
          padding: 0;
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          text-align: center;
      }
      .container {
          background-color: #ffffff;
          border-radius: 8px;
          box-shadow: 0 4px 8px rgba(0,0,0,0.1);
          width: 90%;
          max-width: 600px;
          padding: 20px;
          overflow-y: auto;
          max-height: 80vh;
          margin: 20px;
      }
      h1, h2 { color: #333; margin-bottom: 10px; }
      p { color: #666; margin-bottom: 20px; }
      .buttons a, .buttons button {
          display: block;
          background-color: #000;
          color: white;
          padding: 10px;
          margin: 5px 0;
          text-decoration: none;
          border: none;
          border-radius: 5px;
          font-size: 1em;
          transition: background-color 0.3s;
          cursor: pointer;
      }
      .buttons a:hover, .buttons button:hover { background-color: #333; }
      .footer { font-size: 0.9em; color: #777; margin-top: 20px; }
      form { margin-top: 20px; text-align: left; margin-bottom: 20px; }
      input[type="text"], input[type="number"], textarea, select {
          width: 100%; padding: 10px; margin: 10px 0;
          border: 1px solid #ccc; border-radius: 5px;
      }
      button { width: 100%; margin: 5px 0; }
      table { width: 100%; margin-top: 30px; border-collapse: collapse; }
      th, td { padding: 10px; text-align: left; border: 1px solid #ccc; }
      th { background-color: #f4f4f4; }
      td { background-color: #fafafa; }
      .total { font-size: 1.5em; font-weight: bold; margin: 20px 0; color: #333; }
      .search-container { margin: 20px 0; }
      .search-container input {
          width: 100%; padding: 10px;
          border: 1px solid #ccc; border-radius: 5px;
      }
      .radio-group {
          display: flex; gap: 10px; margin: 10px 0;
      }
      .radio-group label {
          display: flex; align-items: center; gap: 5px;
      }
      /* Modal para imagen */
      .modal {
          display: none;
          position: fixed;
          z-index: 1000;
          left: 0; top: 0;
          width: 100%; height: 100%;
          overflow: auto;
          background-color: rgba(0,0,0,0.7);
          padding-top: 60px;
      }
      .modal-content {
          margin: auto;
          display: block;
          width: 80%;
          max-width: 700px;
      }
      .close {
          position: absolute;
          top: 30px; right: 35px;
          color: #f1f1f1;
          font-size: 40px;
          font-weight: bold;
          transition: 0.3s;
      }
      .close:hover, .close:focus {
          color: #bbb;
          text-decoration: none;
          cursor: pointer;
      }
      @media screen and (max-width: 700px) {
          .modal-content { width: 100%; }
      }
      /* Estilos para el Chatbot AI */
      #chatbot-btn {
          display: block;
          background-color: #000;
          color: #fff;
          border: none;
          padding: 10px 15px;
          border-radius: 5px;
          cursor: pointer;
          margin-top: 10px;
          width: 100%;
      }
      #chatbot {
          display: none;
          background-color: #fff;
          border: 1px solid #ccc;
          border-radius: 5px;
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
          margin-top: 10px;
          padding: 10px;
          text-align: left;
          width: 100%;
          max-width: 600px;
      }
      #chatbot-header {
          background-color: #000;
          color: #fff;
          padding: 10px;
          border-top-left-radius: 5px;
          border-top-right-radius: 5px;
      }
      #chatbot-messages {
          height: 300px;
          overflow-y: auto;
          margin: 10px 0;
          padding: 10px;
          background-color: #f9f9f9;
          border: 1px solid #ccc;
          border-radius: 3px;
      }
      #chatbot-input {
          display: block;
          padding: 10px;
          border-top: 1px solid #ccc;
      }
      #chatbot-input input {
          width: 100%;
          padding: 10px;
          font-size: 16px;
          margin-bottom: 10px;
          box-sizing: border-box;
      }
      #chatbot-input button {
          width: 100%;
          background-color: #000;
          color: #fff;
          border: none;
          padding: 10px;
          cursor: pointer;
          font-size: 16px;
      }
      /* Estilos para el panel de Llamada */
      #call-btn {
          display: block;
          background-color: #000000;
          color: #fff;
          border: none;
          padding: 10px 15px;
          border-radius: 5px;
          cursor: pointer;
          margin-top: 10px;
          width: 100%;
      }
      #call-panel {
          display: none;
          background-color: #fff;
          border: 1px solid #ccc;
          border-radius: 5px;
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
          margin-top: 10px;
          padding: 10px;
          text-align: left;
          width: 100%;
          max-width: 600px;
      }
      #call-header {
          background-color: #000000;
          color: #fff;
          padding: 10px;
          border-top-left-radius: 5px;
          border-top-right-radius: 5px;
      }
      #call-messages {
          height: 200px;
          overflow-y: auto;
          margin: 10px 0;
          padding: 10px;
          background-color: #f9f9f9;
          border: 1px solid #ccc;
          border-radius: 3px;
      }
      #call-controls button {
          display: block;
          width: 100%;
          padding: 10px;
          margin: 5px 0;
          border: none;
          background-color: #000000;
          color: #fff;
          cursor: pointer;
          font-size: 16px;
          border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
          <h1>Contraentrega</h1>
          <p>Cali, Valle del Cauca, Colombia</p>
      </header>
      <!-- Botones de contacto -->
      <div class="buttons">
          <a href="tel:+573215340988" id="llamar-btn">📞 Llamar</a>
          <a href="https://wa.me/573215340988" target="_blank" id="mensaje-btn">💬 Enviar mensaje</a>
          <!-- Botón del Chatbot AI -->
          <button id="chatbot-btn">Chatbot AI</button>
          <!-- Botón para Llamar Asistente -->
          <button id="call-btn">Llamar Asistente</button>
      </div>
      <!-- Panel del Chatbot AI -->
      <div id="chatbot">
          <div id="chatbot-header">
              Chatbot AI <span id="chatbot-close" style="float:right; cursor:pointer;">&times;</span>
          </div>
          <div id="chatbot-messages"></div>
          <div id="chatbot-input">
              <input type="text" id="chatbot-user-input" placeholder="Escribe un mensaje...">
              <button id="chatbot-send">Enviar</button>
          </div>
      </div>
      <!-- Panel de Llamada Asistente -->
      <div id="call-panel">
          <div id="call-header">
              Llamada Asistente <span id="call-close" style="float:right; cursor:pointer;">&times;</span>
          </div>
          <div id="call-messages"></div>
          <div id="call-controls">
              <button id="start-call">Iniciar Llamada</button>
              <button id="stop-call" style="display:none;">Finalizar Llamada</button>
          </div>
      </div>
      <section>
          <!-- Video o contenido multimedia -->
          <div class="video-container">
              <iframe 
                  src="https://www.youtube.com/embed/4J59H-M9iBY" 
                  title="YouTube video player" 
                  frameborder="0" 
                  allow="autoplay; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen>
              </iframe>
          </div>
          <!-- Buscador -->
          <div class="search-container">
              <input type="text" id="search-input" placeholder="Buscar socios por nombre, categorías o información...">
          </div>
          <!-- Socios (Inventario) -->
          <section>
              <h2>Socios</h2>
              <table border="1">
                  <thead>
                      <tr>
                          <th>Imagen</th>
                          <th>Nombre</th>
                          <th>Contacto</th>
                          <th>Ajustar Cantidad</th>
                          <th>Precio Unitario</th>
                          <th>Disponibilidad</th>
                      </tr>
                  </thead>
                  <tbody id="inventario">
                      <!-- Los socios se cargarán dinámicamente -->
                  </tbody>
              </table>
          </section>
          <!-- Checkout -->
          <section>
              <h2>Checkout</h2>
              <h3>Selecciona el método de entrega</h3>
              <div class="radio-group">
                  <label>
                      <input type="radio" name="delivery-method" value="pickup" checked> Recoger en el punto
                  </label>
                  <label>
                      <input type="radio" name="delivery-method" value="delivery"> Servicio a domicilio
                  </label>
              </div>
              <div class="total">
                  Total a pagar: <span id="total-pagar">$0 COP</span>
              </div>
              <h3>Método de pago</h3>
              <div class="buttons">
                  <button type="button" id="connect-nostr">Conectar con Nostr Wallet Connect</button>
                  <button type="button" id="pay-lightning">Pagar con Lightning</button>
              </div>
              <form id="checkout-form" style="display: none;">
                  <h3>Información de envío</h3>
                  <input type="text" name="name" placeholder="Nombre completo" required>
                  <input type="email" name="email" placeholder="Correo electrónico" required>
                  <input type="text" name="address" placeholder="Dirección de envío" required>
                  <input type="text" name="city" placeholder="Ciudad" required>
                  <input type="text" name="state" placeholder="Departamento" required>
                  <input type="text" name="zip" placeholder="Código postal" required>
                  <select name="shipping-method" required>
                      <option value="" disabled selected>Selecciona un método de envío</option>
                      <option value="standard">Envío estándar (5-7 días)</option>
                      <option value="express">Envío express (1-2 días)</option>
                  </select>
              </form>
          </section>
          <!-- Footer -->
          <footer class="footer">
              <p>&copy; 2025 Contraentrega - Todos los derechos reservados</p>
              <p>
                  <a href="https://app.contraentregaco.com/pages/calivalle" class="clickable">Políticas de la empresa</a> | 
                  <a href="https://www.contraentregaco.com/exchange" class="clickable">Recargar saldo lightning con COP</a>
              </p>
          </footer>
      </section>
      <!-- Modal para mostrar la imagen en grande -->
      <div id="image-modal" class="modal">
          <span class="close">&times;</span>
          <img class="modal-content" id="modal-image">
      </div>
    </div>
    <script>
      // Resto del código existente para inventario y checkout
      let cart = {}; 
      let totalQuantity = 0; 
      let totalAmount = 0;
      const dominioPrincipal = "contraentregaco.com";
      // Definimos el subdominio fijo para todos los productos
      const subdominioFijo = "campoalegrecali." + dominioPrincipal;
      
      // Los productos API usarán siempre el mismo subdominio y la ruta variará según el id (quitando el '@')
      const productosAPI = [
          {
              id: "@campoalegrecali",
              nombre: "3215970535",
              precio: 10000,
              disponible: true,
              imagen: "https://via.placeholder.com/300",
              url: "https://" + subdominioFijo + "/campoalegrecali"
          },
          {
              id: "@ejemplo1",
              nombre: "Contacto Ejemplo 1",
              precio: 12000,
              disponible: true,
              imagen: "https://via.placeholder.com/300",
              url: "https://" + subdominioFijo + "/ejemplo1"
          },
          {
              id: "@ejemplo2",
              nombre: "Contacto Ejemplo 2",
              precio: 15000,
              disponible: true,
              imagen: "https://via.placeholder.com/300",
              url: "https://" + subdominioFijo + "/ejemplo2"
          }
      ];
      
      function calcularTotal() {
          totalAmount = 0;
          productosAPI.forEach(producto => {
              if (cart[producto.id]) {
                  totalAmount += producto.precio * cart[producto.id];
              }
          });
          document.getElementById('total-pagar').innerText = '$' + totalAmount.toLocaleString() + ' COP';
      }
      
      function validarFormulario() {
          const form = document.getElementById('checkout-form');
          const inputs = form.querySelectorAll('input, select');
          let valido = true;
          inputs.forEach(input => {
              if (!input.value.trim()) {
                  valido = false;
                  input.style.border = '1px solid red';
              } else {
                  input.style.border = '1px solid #ccc';
              }
          });
          return valido;
      }
      
      function pagarConLightning() {
          if (document.querySelector('input[name="delivery-method"]:checked').value === 'delivery' && !validarFormulario()) {
              alert('Por favor, completa todos los campos del formulario de envío.');
              return;
          }
          const total = totalAmount;
          fetch('https://<YOUR_LNBITS_INSTANCE>/api/v1/payments', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
                  'X-Api-Key': 'YOUR_LNBITS_API_KEY'
              },
              body: JSON.stringify({
                  out: false,
                  amount: total,
                  memo: 'Pago desde @bodegascali'
              })
          })
          .then(response => response.json())
          .then(data => {
              if (data.payment_request) {
                  alert('Escanea este código QR para pagar: ' + data.payment_request);
                  if (nostrPubkey) {
                      signAndPublishPaymentEvent(data.payment_request);
                  }
              } else {
                  alert('Error al generar la factura Lightning.');
              }
          })
          .catch(error => {
              console.error('Error:', error);
              alert('Error al conectar con el servidor de pagos.');
          });
      }
      
      async function connectNostrWallet() {
          if (window.nostr) {
              try {
                  nostrPubkey = await window.nostr.getPublicKey();
                  alert("Conectado con Nostr Wallet. Tu clave pública: " + nostrPubkey);
              } catch (error) {
                  console.error(error);
                  alert("Error conectando con Nostr Wallet.");
              }
          } else {
              alert("Nostr Wallet no encontrada. Instala una extensión compatible.");
          }
      }
      
      async function signAndPublishPaymentEvent(invoice) {
          const event = {
              kind: 30000,
              pubkey: nostrPubkey,
              created_at: Math.floor(Date.now() / 1000),
              tags: [['payment', invoice]],
              content: 'Pago realizado a través de Lightning Network'
          };
          if (window.nostr && window.nostr.signEvent && window.nostr.publish) {
              try {
                  const signedEvent = await window.nostr.signEvent(event);
                  await window.nostr.publish(signedEvent);
                  alert('Evento de pago publicado en Nostr.');
              } catch (err) {
                  console.error('Error al firmar/publicar el evento:', err);
                  alert('Error al publicar el evento en Nostr.');
              }
          } else {
              console.log('No se pudieron firmar/publicar eventos con Nostr.');
          }
      }
      
      function filtrarProductos(query) {
          const tbody = document.getElementById("inventario");
          const filas = tbody.getElementsByTagName("tr");
          for (let fila of filas) {
              const nombre = fila.getElementsByTagName("td")[1].innerText.toLowerCase();
              const contacto = fila.getElementsByTagName("td")[2].innerText.toLowerCase();
              if (nombre.includes(query) || contacto.includes(query)) {
                  fila.style.display = "";
              } else {
                  fila.style.display = "none";
              }
          }
      }
      
      function cargarInventario() {
          const tbody = document.getElementById("inventario");
          tbody.innerHTML = "";
          productosAPI.forEach(producto => {
              const fila = document.createElement("tr");
              fila.innerHTML = 
                  '<td><a href="#" class="ver-imagen" data-imagen="' + producto.imagen + '">ver</a></td>' +
                  '<td><a href="' + producto.url + '" target="_blank">' + producto.id + '</a></td>' +
                  '<td>' + producto.nombre + '</td>' +
                  '<td>' +
                      '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="decrease">-</button>' +
                      '<span id="cantidad-' + producto.id + '">0</span>' +
                      '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="increase">+</button>' +
                  '</td>' +
                  '<td>$' + producto.precio.toLocaleString() + ' COP</td>' +
                  '<td>' + (producto.disponible ? "Disponible" : "Agotado") + '</td>';
              tbody.appendChild(fila);
          });
          asignarEventosBotones();
      }
      
      function asignarEventosBotones() {
          document.querySelectorAll(".adjust-quantity").forEach(button => {
              button.addEventListener("click", (event) => {
                  const productId = event.target.dataset.product;
                  const action = event.target.dataset.action;
                  if (!cart[productId]) {
                      cart[productId] = 0;
                  }
                  if (action === "increase") {
                      cart[productId]++;
                      totalQuantity++;
                  } else if (action === "decrease" && cart[productId] > 0) {
                      cart[productId]--;
                      totalQuantity--;
                  }
                  document.getElementById('cantidad-' + productId).innerText = cart[productId];
                  calcularTotal();
              });
          });
      }
      
      document.getElementById('search-input').addEventListener('input', (event) => {
          const query = event.target.value.toLowerCase();
          filtrarProductos(query);
      });
      
      document.querySelectorAll('input[name="delivery-method"]').forEach(radio => {
          radio.addEventListener('change', (event) => {
              const form = document.getElementById('checkout-form');
              form.style.display = event.target.value === 'delivery' ? 'block' : 'none';
          });
      });
      
      document.getElementById('pay-lightning').addEventListener('click', pagarConLightning);
      document.getElementById('connect-nostr').addEventListener('click', connectNostrWallet);
      
      document.addEventListener('click', function(e) {
          if (e.target && e.target.classList.contains('ver-imagen')) {
              e.preventDefault();
              const imageUrl = e.target.getAttribute('data-imagen');
              const modal = document.getElementById('image-modal');
              const modalImg = document.getElementById('modal-image');
              modal.style.display = "block";
              modalImg.src = imageUrl;
          }
      });
      
      document.getElementById('image-modal').addEventListener('click', function(e) {
          if (e.target.classList.contains('close') || e.target.id === 'image-modal') {
              this.style.display = "none";
          }
      });
      
      cargarInventario();
      
      // Funcionalidad del Chatbot AI
      document.getElementById('chatbot-btn').addEventListener('click', function() {
          var chatbot = document.getElementById('chatbot');
          chatbot.style.display = (chatbot.style.display === 'none' || chatbot.style.display === '') ? 'block' : 'none';
      });
      
      document.getElementById('chatbot-close').addEventListener('click', function() {
          document.getElementById('chatbot').style.display = 'none';
      });
      
      document.getElementById('chatbot-send').addEventListener('click', function() {
          var input = document.getElementById('chatbot-user-input');
          var message = input.value.trim();
          if (!message) return;
          var messagesContainer = document.getElementById('chatbot-messages');
          var userMessageDiv = document.createElement('div');
          userMessageDiv.textContent = 'Tú: ' + message;
          messagesContainer.appendChild(userMessageDiv);
          input.value = '';
          fetch('/chat', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ message: message })
          })
          .then(response => response.json())
          .then(data => {
              var replyDiv = document.createElement('div');
              replyDiv.textContent = 'Chatbot: ' + data.reply;
              messagesContainer.appendChild(replyDiv);
          })
          .catch(err => {
              console.error(err);
              var errorDiv = document.createElement('div');
              errorDiv.textContent = 'Chatbot: Error al procesar el mensaje.';
              messagesContainer.appendChild(errorDiv);
          });
      });
      
      // Funcionalidad de Llamada Asistente usando Web Speech API y TTS premium
      document.getElementById('call-btn').addEventListener('click', function() {
          var callPanel = document.getElementById('call-panel');
          callPanel.style.display = (callPanel.style.display === 'none' || callPanel.style.display === '') ? 'block' : 'none';
      });
      
      document.getElementById('call-close').addEventListener('click', function() {
          document.getElementById('call-panel').style.display = 'none';
      });
      
      var recognition;
      if ('webkitSpeechRecognition' in window) {
         recognition = new webkitSpeechRecognition();
      } else if ('SpeechRecognition' in window) {
         recognition = new SpeechRecognition();
      }
      
      if (recognition) {
         recognition.continuous = false;
         recognition.lang = 'es-ES';
         recognition.interimResults = false;
         recognition.maxAlternatives = 1;
      
         recognition.onresult = function(event) {
            var transcript = event.results[0][0].transcript;
            var callMessages = document.getElementById('call-messages');
            var userMsg = document.createElement('div');
            userMsg.textContent = 'Tú: ' + transcript;
            callMessages.appendChild(userMsg);
            // Enviar el mensaje al endpoint /chat
            fetch('/chat', {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ message: transcript })
            })
            .then(response => response.json())
            .then(data => {
                var replyMsg = document.createElement('div');
                replyMsg.textContent = 'Asistente: ' + data.reply;
                callMessages.appendChild(replyMsg);
                // Usar el endpoint /tts para obtener audio de alta calidad (TTS premium)
                fetch('/tts', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ text: data.reply })
                })
                .then(response => response.blob())
                .then(blob => {
                   var audioUrl = URL.createObjectURL(blob);
                   var audio = new Audio(audioUrl);
                   audio.play();
                })
                .catch(err => {
                   console.error('Error en TTS:', err);
                   // Fallback: Web Speech Synthesis
                   var utterance = new SpeechSynthesisUtterance(data.reply);
                   utterance.lang = 'es-ES';
                   window.speechSynthesis.speak(utterance);
                });
            })
            .catch(err => {
                console.error(err);
                var errorMsg = document.createElement('div');
                errorMsg.textContent = 'Asistente: Error al procesar el mensaje.';
                callMessages.appendChild(errorMsg);
            });
         };
      
         recognition.onerror = function(event) {
            console.error('Error de reconocimiento de voz:', event.error);
         };
      } else {
         document.getElementById('call-btn').style.display = 'none';
      }
      
      document.getElementById('start-call').addEventListener('click', function() {
         if (recognition) {
             recognition.start();
             document.getElementById('start-call').style.display = 'none';
             document.getElementById('stop-call').style.display = 'block';
         }
      });
      
      document.getElementById('stop-call').addEventListener('click', function() {
         if (recognition) {
             recognition.stop();
             document.getElementById('stop-call').style.display = 'none';
             document.getElementById('start-call').style.display = 'block';
         }
      });
    </script>
  </body>
  </html>
  `;
  
  return new Response(htmlContent, {
    headers: { 'Content-Type': 'text/html' },
  });
}

Pagina sucursal: 
addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

// Variable para almacenar la clave pública de Nostr del usuario
let nostrPubkey = null;

// Información de la empresa (base de conocimiento)
const companyInfo = `Contraentrega es una empresa especializada en la compra y venta en línea en Armenia Quindío, Colombia. Ofrecemos servicios de logística, mensajería y asesoría personalizada para facilitar la interacción entre compradores y vendedores. Nuestro compromiso es brindar un servicio seguro, rápido y confiable, impulsando el crecimiento económico en la región.`

async function handleRequest(request) {
  const url = new URL(request.url);

  // Endpoint operativo para el Chatbot AI
  if (url.pathname === '/chat' && request.method === 'POST') {
    try {
      const { message } = await request.json();
      // Llamada a la API de OpenAI con contexto incluido en el prompt
      const apiKey = 'YOUR_OPENAI_API_KEY'; // Reemplaza con tu API Key o usa Secrets
      const apiResponse = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'gpt-3.5-turbo',
          messages: [
            { "role": "system", "content": `Eres un asistente AI experto en Contraentrega. ${companyInfo}` },
            { "role": "user", "content": message }
          ],
        }),
      });
      const apiResult = await apiResponse.json();
      const reply = apiResult.choices &&
                    apiResult.choices[0] &&
                    apiResult.choices[0].message &&
                    apiResult.choices[0].message.content
                    ? apiResult.choices[0].message.content.trim()
                    : "Lo siento, no pude obtener una respuesta.";
      return new Response(JSON.stringify({ reply }), {
        headers: { 'Content-Type': 'application/json' },
      });
    } catch (e) {
      return new Response(JSON.stringify({ reply: "Error al procesar el mensaje: " + e.toString() }), {
        headers: { 'Content-Type': 'application/json' },
      });
    }
  }

  // Si no es la ruta /chat, se devuelve el HTML de la página
  const htmlContent = `
  <!DOCTYPE html>
  <html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Worldwide Logistics Services.">
    <meta name="keywords" content="armenia quindio, compra, venta, clasificados, productos, Colombia, Contraentrega">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Contraentrega">
    <meta property="og:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
    <meta property="og:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
    <meta property="og:image" content="URL-de-tu-imagen">
    <meta property="og:url" content="https://www.tusitio.com">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
    <meta name="twitter:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
    <meta name="twitter:image" content="URL-de-tu-imagen">
    <meta name="twitter:url" content="https://www.tusitio.com">
    <meta name="google-site-verification" content="your-verification-code" />
    <!-- Facebook Pixel -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', 'your-pixel-id');
        fbq('track', 'PageView');
    </script>
    <noscript>
        <img height="1" width="1" style="display:none"
        src="https://www.facebook.com/tr?id=your-pixel-id&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Facebook Pixel -->
    <title>@armeniaquindio - Compra y venta en Armenia Quindío</title>
    <!-- Datos estructurados con Schema.org -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "url": "https://www.tusitio.com",
      "name": "@armeniaquindio",
      "description": "Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.",
      "publisher": {
          "@type": "Organization",
          "name": "Contraentrega Armenia Quindío"
      }
    }
    </script>
    <!-- Favicon -->
    <link rel="icon" href="URL-del-favicon" type="image/png">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_TRACKING_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'YOUR_TRACKING_ID');
    </script>
    <style>
      /* Estilos generales de la página */
      body {
          font-family: Arial, sans-serif;
          background-color: #f1f1f1;
          margin: 0;
          padding: 0;
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          text-align: center;
      }
      .container {
          background-color: #ffffff;
          border-radius: 8px;
          box-shadow: 0 4px 8px rgba(0,0,0,0.1);
          width: 90%;
          max-width: 600px;
          padding: 20px;
          overflow-y: auto;
          max-height: 80vh;
          margin: 20px;
      }
      h1, h2 { color: #333; margin-bottom: 10px; }
      p { color: #666; margin-bottom: 20px; }
      .buttons a, .buttons button {
          display: block;
          background-color: #000;
          color: white;
          padding: 10px;
          margin: 5px 0;
          text-decoration: none;
          border: none;
          border-radius: 5px;
          font-size: 1em;
          transition: background-color 0.3s;
          cursor: pointer;
      }
      .buttons a:hover, .buttons button:hover { background-color: #333; }
      .footer { font-size: 0.9em; color: #777; margin-top: 20px; }
      form { margin-top: 20px; text-align: left; margin-bottom: 20px; }
      input[type="text"], input[type="number"], textarea, select {
          width: 100%; padding: 10px; margin: 10px 0;
          border: 1px solid #ccc; border-radius: 5px;
      }
      button { width: 100%; margin: 5px 0; }
      table { width: 100%; margin-top: 30px; border-collapse: collapse; }
      th, td {
          padding: 10px; text-align: left; border: 1px solid #ccc;
      }
      th { background-color: #f4f4f4; }
      td { background-color: #fafafa; }
      .total { font-size: 1.5em; font-weight: bold; margin: 20px 0; color: #333; }
      .search-container { margin: 20px 0; }
      .search-container input {
          width: 100%; padding: 10px;
          border: 1px solid #ccc; border-radius: 5px;
      }
      .radio-group {
          display: flex; gap: 10px; margin: 10px 0;
      }
      .radio-group label {
          display: flex; align-items: center; gap: 5px;
      }
      /* Modal para imagen */
      .modal {
          display: none;
          position: fixed;
          z-index: 1000;
          left: 0; top: 0;
          width: 100%; height: 100%;
          overflow: auto;
          background-color: rgba(0,0,0,0.7);
          padding-top: 60px;
      }
      .modal-content {
          margin: auto;
          display: block;
          width: 80%;
          max-width: 700px;
      }
      .close {
          position: absolute;
          top: 30px; right: 35px;
          color: #f1f1f1;
          font-size: 40px;
          font-weight: bold;
          transition: 0.3s;
      }
      .close:hover, .close:focus {
          color: #bbb;
          text-decoration: none;
          cursor: pointer;
      }
      @media screen and (max-width: 700px) {
          .modal-content { width: 100%; }
      }
      /* Estilos para el Chatbot AI dentro del flujo */
      #chatbot-btn {
          display: block;
          background-color: #000;
          color: #fff;
          border: none;
          padding: 10px 15px;
          border-radius: 5px;
          cursor: pointer;
          margin-top: 10px;
          width: 100%;
      }
      #chatbot {
          display: none;
          background-color: #fff;
          border: 1px solid #ccc;
          border-radius: 5px;
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
          margin-top: 10px;
          padding: 10px;
          text-align: left;
          width: 100%;
          max-width: 600px;
      }
      #chatbot-header {
          background-color: #000;
          color: #fff;
          padding: 10px;
          border-top-left-radius: 5px;
          border-top-right-radius: 5px;
      }
      #chatbot-messages {
          height: 300px;
          overflow-y: auto;
          margin: 10px 0;
          padding: 10px;
          background-color: #f9f9f9;
          border: 1px solid #ccc;
          border-radius: 3px;
      }
      /* Aquí se ajusta el input para que ocupe todo el ancho y el botón quede debajo */
      #chatbot-input {
          display: block;
          padding: 10px;
          border-top: 1px solid #ccc;
      }
      #chatbot-input input {
          width: 100%;
          padding: 10px;
          font-size: 16px;
          margin-bottom: 10px;
          box-sizing: border-box;
      }
      #chatbot-input button {
          width: 100%;
          background-color: #000;
          color: #fff;
          border: none;
          padding: 10px;
          cursor: pointer;
          font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
          <h1>Contraentrega</h1>
          <p>Cali, Valle del Cauca, Colombia</p>
      </header>
      <!-- Botones de contacto -->
      <div class="buttons">
          <a href="tel:+573215340988" id="llamar-btn">📞 Llamar</a>
          <a href="https://wa.me/573215340988" target="_blank" id="mensaje-btn">💬 Enviar mensaje</a>
          <!-- Botón del Chatbot AI ubicado aquí, justo debajo de "Enviar mensaje" -->
          <button id="chatbot-btn">Chatbot AI</button>
      </div>
      <!-- Panel del Chatbot AI (dentro del flujo) -->
      <div id="chatbot">
          <div id="chatbot-header">
              Chatbot AI <span id="chatbot-close" style="float:right; cursor:pointer;">&times;</span>
          </div>
          <div id="chatbot-messages"></div>
          <div id="chatbot-input">
              <input type="text" id="chatbot-user-input" placeholder="Escribe un mensaje...">
              <button id="chatbot-send">Enviar</button>
          </div>
      </div>
      <section>
          <!-- Video o contenido multimedia -->
          <div class="video-container">
              <iframe 
                  src="https://www.youtube.com/embed/4J59H-M9iBY" 
                  title="YouTube video player" 
                  frameborder="0" 
                  allow="autoplay; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen>
              </iframe>
          </div>
          <!-- Buscador -->
          <div class="search-container">
              <input type="text" id="search-input" placeholder="Buscar socios por nombre, categorías o información...">
          </div>
          <!-- Socios (Inventario) -->
          <section>
              <h2>Socios</h2>
              <table border="1">
                  <thead>
                      <tr>
                          <th>Imagen</th>
                          <th>Nombre</th>
                          <th>Contacto</th>
                          <th>Ajustar Cantidad</th>
                          <th>Precio Unitario</th>
                          <th>Disponibilidad</th>
                      </tr>
                  </thead>
                  <tbody id="inventario">
                      <!-- Los socios se cargarán dinámicamente -->
                  </tbody>
              </table>
          </section>
          <!-- Checkout -->
          <section>
              <h2>Checkout</h2>
              <h3>Selecciona el método de entrega</h3>
              <div class="radio-group">
                  <label>
                      <input type="radio" name="delivery-method" value="pickup" checked> Recoger en el punto
                  </label>
                  <label>
                      <input type="radio" name="delivery-method" value="delivery"> Servicio a domicilio
                  </label>
              </div>
              <div class="total">
                  Total a pagar: <span id="total-pagar">$0 COP</span>
              </div>
              <h3>Método de pago</h3>
              <div class="buttons">
                  <button type="button" id="connect-nostr">Conectar con Nostr Wallet Connect</button>
                  <button type="button" id="pay-lightning">Pagar con Lightning</button>
              </div>
              <form id="checkout-form" style="display: none;">
                  <h3>Información de envío</h3>
                  <input type="text" name="name" placeholder="Nombre completo" required>
                  <input type="email" name="email" placeholder="Correo electrónico" required>
                  <input type="text" name="address" placeholder="Dirección de envío" required>
                  <input type="text" name="city" placeholder="Ciudad" required>
                  <input type="text" name="state" placeholder="Departamento" required>
                  <input type="text" name="zip" placeholder="Código postal" required>
                  <select name="shipping-method" required>
                      <option value="" disabled selected>Selecciona un método de envío</option>
                      <option value="standard">Envío estándar (5-7 días)</option>
                      <option value="express">Envío express (1-2 días)</option>
                  </select>
              </form>
          </section>
          <!-- Footer -->
          <footer class="footer">
              <p>&copy; 2025 Contraentrega - Todos los derechos reservados</p>
              <p>
                  <a href="https://www.tusitio.com/privacy" class="clickable">Política de privacidad</a> | 
                  <a href="https://www.tusitio.com/terms" class="clickable">Términos y condiciones</a>
              </p>
          </footer>
      </section>
      <!-- Modal para mostrar la imagen en grande -->
      <div id="image-modal" class="modal">
          <span class="close">&times;</span>
          <img class="modal-content" id="modal-image">
      </div>
    </div>
    <script>
      let cart = {}; 
      let totalQuantity = 0; 
      let totalAmount = 0;
      const dominioPrincipal = "tusitio.com";
      const productosAPI = [
          {
              id: "@campoalegrecali",
              nombre: "3215970535",
              precio: 10000,
              disponible: true,
              imagen: "https://via.placeholder.com/300",
              url: "https://" + "campoalegrecali" + "." + dominioPrincipal
          },
          {
              id: "@ejemplo1",
              nombre: "Contacto Ejemplo 1",
              precio: 12000,
              disponible: true,
              imagen: "https://via.placeholder.com/300",
              url: "https://" + "ejemplo1" + "." + dominioPrincipal
          },
          {
              id: "@ejemplo2",
              nombre: "Contacto Ejemplo 2",
              precio: 15000,
              disponible: true,
              imagen: "https://via.placeholder.com/300",
              url: "https://" + "ejemplo2" + "." + dominioPrincipal
          }
      ];
      
      function calcularTotal() {
          totalAmount = 0;
          productosAPI.forEach(producto => {
              if (cart[producto.id]) {
                  totalAmount += producto.precio * cart[producto.id];
              }
          });
          document.getElementById('total-pagar').innerText = '$' + totalAmount.toLocaleString() + ' COP';
      }
      
      function validarFormulario() {
          const form = document.getElementById('checkout-form');
          const inputs = form.querySelectorAll('input, select');
          let valido = true;
          inputs.forEach(input => {
              if (!input.value.trim()) {
                  valido = false;
                  input.style.border = '1px solid red';
              } else {
                  input.style.border = '1px solid #ccc';
              }
          });
          return valido;
      }
      
      function pagarConLightning() {
          if (document.querySelector('input[name="delivery-method"]:checked').value === 'delivery' && !validarFormulario()) {
              alert('Por favor, completa todos los campos del formulario de envío.');
              return;
          }
          const total = totalAmount;
          fetch('https://<YOUR_LNBITS_INSTANCE>/api/v1/payments', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
                  'X-Api-Key': 'YOUR_LNBITS_API_KEY'
              },
              body: JSON.stringify({
                  out: false,
                  amount: total,
                  memo: 'Pago desde @bodegascali'
              })
          })
          .then(response => response.json())
          .then(data => {
              if (data.payment_request) {
                  alert('Escanea este código QR para pagar: ' + data.payment_request);
                  if (nostrPubkey) {
                      signAndPublishPaymentEvent(data.payment_request);
                  }
              } else {
                  alert('Error al generar la factura Lightning.');
              }
          })
          .catch(error => {
              console.error('Error:', error);
              alert('Error al conectar con el servidor de pagos.');
          });
      }
      
      async function connectNostrWallet() {
          if (window.nostr) {
              try {
                  nostrPubkey = await window.nostr.getPublicKey();
                  alert("Conectado con Nostr Wallet. Tu clave pública: " + nostrPubkey);
              } catch (error) {
                  console.error(error);
                  alert("Error conectando con Nostr Wallet.");
              }
          } else {
              alert("Nostr Wallet no encontrada. Instala una extensión compatible.");
          }
      }
      
      async function signAndPublishPaymentEvent(invoice) {
          const event = {
              kind: 30000,
              pubkey: nostrPubkey,
              created_at: Math.floor(Date.now() / 1000),
              tags: [['payment', invoice]],
              content: 'Pago realizado a través de Lightning Network'
          };
          if (window.nostr && window.nostr.signEvent && window.nostr.publish) {
              try {
                  const signedEvent = await window.nostr.signEvent(event);
                  await window.nostr.publish(signedEvent);
                  alert('Evento de pago publicado en Nostr.');
              } catch (err) {
                  console.error('Error al firmar/publicar el evento:', err);
                  alert('Error al publicar el evento en Nostr.');
              }
          } else {
              console.log('No se pudieron firmar/publicar eventos con Nostr.');
          }
      }
      
      function filtrarProductos(query) {
          const tbody = document.getElementById("inventario");
          const filas = tbody.getElementsByTagName("tr");
          for (let fila of filas) {
              const nombre = fila.getElementsByTagName("td")[1].innerText.toLowerCase();
              const contacto = fila.getElementsByTagName("td")[2].innerText.toLowerCase();
              if (nombre.includes(query) || contacto.includes(query)) {
                  fila.style.display = "";
              } else {
                  fila.style.display = "none";
              }
          }
      }
      
      function cargarInventario() {
          const tbody = document.getElementById("inventario");
          tbody.innerHTML = "";
          productosAPI.forEach(producto => {
              const fila = document.createElement("tr");
              fila.innerHTML = 
                  '<td><a href="#" class="ver-imagen" data-imagen="' + producto.imagen + '">ver</a></td>' +
                  '<td><a href="' + producto.url + '" target="_blank">' + producto.id + '</a></td>' +
                  '<td>' + producto.nombre + '</td>' +
                  '<td>' +
                      '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="decrease">-</button>' +
                      '<span id="cantidad-' + producto.id + '">0</span>' +
                      '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="increase">+</button>' +
                  '</td>' +
                  '<td>$' + producto.precio.toLocaleString() + ' COP</td>' +
                  '<td>' + (producto.disponible ? "Disponible" : "Agotado") + '</td>';
              tbody.appendChild(fila);
          });
          asignarEventosBotones();
      }
      
      function asignarEventosBotones() {
          document.querySelectorAll(".adjust-quantity").forEach(button => {
              button.addEventListener("click", (event) => {
                  const productId = event.target.dataset.product;
                  const action = event.target.dataset.action;
                  if (!cart[productId]) {
                      cart[productId] = 0;
                  }
                  if (action === "increase") {
                      cart[productId]++;
                      totalQuantity++;
                  } else if (action === "decrease" && cart[productId] > 0) {
                      cart[productId]--;
                      totalQuantity--;
                  }
                  document.getElementById('cantidad-' + productId).innerText = cart[productId];
                  calcularTotal();
              });
          });
      }
      
      document.getElementById('search-input').addEventListener('input', (event) => {
          const query = event.target.value.toLowerCase();
          filtrarProductos(query);
      });
      
      document.querySelectorAll('input[name="delivery-method"]').forEach(radio => {
          radio.addEventListener('change', (event) => {
              const form = document.getElementById('checkout-form');
              form.style.display = event.target.value === 'delivery' ? 'block' : 'none';
          });
      });
      
      document.getElementById('pay-lightning').addEventListener('click', pagarConLightning);
      document.getElementById('connect-nostr').addEventListener('click', connectNostrWallet);
      
      document.addEventListener('click', function(e) {
          if (e.target && e.target.classList.contains('ver-imagen')) {
              e.preventDefault();
              const imageUrl = e.target.getAttribute('data-imagen');
              const modal = document.getElementById('image-modal');
              const modalImg = document.getElementById('modal-image');
              modal.style.display = "block";
              modalImg.src = imageUrl;
          }
      });
      
      document.getElementById('image-modal').addEventListener('click', function(e) {
          if (e.target.classList.contains('close') || e.target.id === 'image-modal') {
              this.style.display = "none";
          }
      });
      
      cargarInventario();
      
      // Funcionalidad del Chatbot AI
      document.getElementById('chatbot-btn').addEventListener('click', function() {
          var chatbot = document.getElementById('chatbot');
          chatbot.style.display = (chatbot.style.display === 'none' || chatbot.style.display === '') ? 'block' : 'none';
      });
      
      document.getElementById('chatbot-close').addEventListener('click', function() {
          document.getElementById('chatbot').style.display = 'none';
      });
      
      document.getElementById('chatbot-send').addEventListener('click', function() {
          var input = document.getElementById('chatbot-user-input');
          var message = input.value.trim();
          if (!message) return;
          var messagesContainer = document.getElementById('chatbot-messages');
          var userMessageDiv = document.createElement('div');
          userMessageDiv.textContent = 'Tú: ' + message;
          messagesContainer.appendChild(userMessageDiv);
          input.value = '';
          fetch('/chat', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ message: message })
          })
          .then(response => response.json())
          .then(data => {
              var replyDiv = document.createElement('div');
              replyDiv.textContent = 'Chatbot: ' + data.reply;
              messagesContainer.appendChild(replyDiv);
          })
          .catch(err => {
              console.error(err);
              var errorDiv = document.createElement('div');
              errorDiv.textContent = 'Chatbot: Error al procesar el mensaje.';
              messagesContainer.appendChild(errorDiv);
          });
      });
    </script>
  </body>
  </html>
  `;
  
  return new Response(htmlContent, {
    headers: { 'Content-Type': 'text/html' },
  });
}
Inventario Manual  Cryptomus:

addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

async function handleRequest(request) {
  const htmlContent = `
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Worldwide Logistics Services.">
    <meta name="keywords" content="armenia quindio, compra, venta, clasificados, productos, Colombia, Contraentrega">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Contraentrega">
    <meta property="og:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
    <meta property="og:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
    <meta property="og:image" content="URL-de-tu-imagen">
    <meta property="og:url" content="https://www.tusitio.com">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
    <meta name="twitter:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
    <meta name="twitter:image" content="URL-de-tu-imagen">
    <meta name="twitter:url" content="https://www.tusitio.com">
    <meta name="google-site-verification" content="your-verification-code" />

    <!-- Facebook Pixel -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', 'your-pixel-id');
        fbq('track', 'PageView');
    </script>
    <noscript>
        <img height="1" width="1" style="display:none"
        src="https://www.facebook.com/tr?id=your-pixel-id&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Facebook Pixel -->

    <title>@armeniaquindio - Compra y venta en Armenia Quindío</title>

    <!-- Datos estructurados con Schema.org -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "url": "https://www.tusitio.com",
        "name": "@armeniaquindio",
        "description": "Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.",
        "publisher": {
            "@type": "Organization",
            "name": "Contraentrega Armenia Quindío"
        }
    }
    </script>

    <!-- Favicon -->
    <link rel="icon" href="URL-del-favicon" type="image/png">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_TRACKING_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'YOUR_TRACKING_ID');
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f1f1f1;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
        }
        .container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 90%; 
            max-width: 600px; 
            padding: 20px;
            overflow-y: auto; 
            max-height: 80vh; 
            height: 100%; 
        }
        h1, h2 {
            font-size: 2.5em;
            color: #333;
            margin-bottom: 10px;
        }
        p {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        .buttons a {
            display: block;
            background-color: #000000;
            color: white;
            padding: 10px;
            margin: 5px 0;
            text-decoration: none;
            border-radius: 5px;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        .buttons a:hover {
            background-color: #333333;
        }
        .footer {
            font-size: 0.9em;
            color: #777;
            margin-top: 20px;
        }
        form {
            margin-top: 20px;
            text-align: left;
            margin-bottom: 20px;
        }
        input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        input[type="file"] {
            margin: 10px 0;
        }
        button {
            background-color: #000000;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            width: 100%;
            margin: 5px 0;
        }
        button:hover {
            background-color: #333333;
        }
        table {
            width: 100%;
            margin-top: 30px;
            border-collapse: collapse;
            overflow-x: auto;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ccc;
        }
        th {
            background-color: #f4f4f4;
        }
        td {
            background-color: #fafafa;
        }
        h2 {
            font-size: 1.8em;
            color: #333;
            margin-top: 20px;
        }

        .clickable {
            color: #007BFF;
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.3s ease-in-out;
        }

        .clickable:hover {
            color: #0056b3;
            text-decoration: none;
        }

        /* Lazy loading de imágenes */
        img[loading="lazy"] {
            opacity: 0;
            transition: opacity 0.3s ease-in;
        }
        img[loading="lazy"]:not([src=""]) {
            opacity: 1;
        }

        /* Estilo para el total */
        .total {
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
            color: #333;
        }

        /* Estilo para el buscador */
        .search-container {
            margin: 20px 0;
        }
        .search-container input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        /* Estilo para los radio buttons */
        .radio-group {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <h1>@bodegascali</h1>
            <p>Punto: Vereda Campoalegre, Oeste Cali, Valle, Colombia</p>
        </header>

        <!-- Botones de contacto -->
        <div class="buttons">
            <a href="tel:+573001234567" id="llamar-btn">📞 Llamar</a>
            <a href="https://wa.me/573001234567" target="_blank" id="mensaje-btn">💬 Enviar mensaje</a>
        </div>

        <section>
            <p>CÓDIGO: 1</p>

            <!-- SKU #1 -->
            <div class="video-container">
                <iframe 
                    src="https://www.youtube.com/embed/4J59H-M9iBY" 
                    title="YouTube video player" 
                    frameborder="0" 
                    allow="autoplay; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            </div>

            <!-- Buscador -->
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Buscar productos por nombre, código o precio...">
            </div>

            <!-- Inventario -->
            <section>
                <h2>Inventario</h2>
                <table border="1">
                    <thead>
                        <tr>
                            <th>Imagen</th>
                            <th>Código</th>
                            <th>Nombre</th>
                            <th>Ajustar Cantidad</th>
                            <th>Precio Unitario</th>
                            <th>Disponibilidad</th>
                        </tr>
                    </thead>
                    <tbody id="inventario">
                        <!-- Los productos se insertarán aquí dinámicamente -->
                    </tbody>
                </table>
            </section>

            <!-- Checkout -->
            <section>
                <h2>Checkout</h2>

                <!-- Opciones de entrega -->
                <h3>Selecciona el método de entrega</h3>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="delivery-method" value="pickup" checked> Recoger en el punto
                    </label>
                    <label>
                        <input type="radio" name="delivery-method" value="delivery"> Servicio a domicilio
                    </label>
                </div>

                <!-- Total a pagar -->
                <div class="total">
                    Total a pagar: <span id="total-pagar">$0 COP</span>
                </div>

                <!-- Métodos de pago -->
                <h3>Método de pago</h3>
                <div>
                    <button type="button" id="pay-crypto">Pagar con Crypto (Cryptomus)</button>
                </div>

                <!-- Formulario de envío (oculto por defecto) -->
                <form id="checkout-form" style="display: none;">
                    <h3>Información de envío</h3>
                    <input type="text" name="name" placeholder="Nombre completo" required>
                    <input type="email" name="email" placeholder="Correo electrónico" required>
                    <input type="text" name="address" placeholder="Dirección de envío" required>
                    <input type="text" name="city" placeholder="Ciudad" required>
                    <input type="text" name="state" placeholder="Departamento" required>
                    <input type="text" name="zip" placeholder="Código postal" required>
                    <select name="shipping-method" required>
                        <option value="" disabled selected>Selecciona un método de envío</option>
                        <option value="standard">Envío estándar (5-7 días)</option>
                        <option value="express">Envío express (1-2 días)</option>
                    </select>
                </form>
            </section>

            <!-- Footer -->
            <footer class="footer">
                <p>&copy; 2025 Contraentrega - Todos los derechos reservados</p>
                <p><a href="https://www.tusitio.com/privacy" class="clickable">Política de privacidad</a> | <a href="https://www.tusitio.com/terms" class="clickable">Términos y condiciones</a></p>
            </footer>
        </div>

        <script>
    let cart = {};
    let totalQuantity = 0;
    let totalAmount = 0;

    const productosAPI = [
        { id: "P001", nombre: "Laptop", precio: 2500000, disponible: true, imagen: "https://via.placeholder.com/50" },
        { id: "P002", nombre: "Mouse Gamer", precio: 120000, disponible: true, imagen: "https://via.placeholder.com/50" },
        { id: "P003", nombre: "Teclado Mecánico", precio: 350000, disponible: false, imagen: "https://via.placeholder.com/50" }
    ];

    // Función para procesar pago con Cryptomus
        async function pagarConCrypto() {
            if (document.querySelector('input[name="delivery-method"]:checked').value === 'delivery' && !validarFormulario()) {
                alert('Por favor, completa todos los campos del formulario de envío.');
                return;
            }

            const paymentData = {
                amount: totalAmount.toString(),
                currency: "COP",
                order_id: \`order*${Date.now()}\`,
            };

            try {
                const response = await fetch('https://api.cryptomus.com/v1/payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'api-key': 'TU_API_KEY_CRYPTOMUS', // Usa secretos de Cloudflare
                        'merchant': 'TU_MERCHANT_ID' // Usa secretos de Cloudflare
                    },
                    body: JSON.stringify(paymentData)
                });

                const result = await response.json();

                if (result.result && result.result.url) {
                    window.location.href = result.result.url;
                } else {
                    alert('Error al procesar el pago: ' + (result.message || 'Error desconocido'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al conectar con el servicio de pagos');
            }
        }

    function calcularTotal() {
        totalAmount = 0;
        productosAPI.forEach(producto => {
            if (cart[producto.id]) {
                totalAmount += producto.precio * cart[producto.id];
            }
        });
        document.getElementById('total-pagar').innerText = '$' + totalAmount.toLocaleString() + ' COP';
    }

    function validarFormulario() {
        const form = document.getElementById('checkout-form');
        const inputs = form.querySelectorAll('input, select');
        let valido = true;

        inputs.forEach(input => {
            if (!input.value.trim()) {
                valido = false;
                input.style.border = '1px solid red';
            } else {
                input.style.border = '1px solid #ccc';
            }
        });

        return valido;
    }

    function filtrarProductos(query) {
        const tbody = document.getElementById("inventario");
        const filas = tbody.getElementsByTagName("tr");

        for (let fila of filas) {
            const nombre = fila.getElementsByTagName("td")[2].innerText.toLowerCase();
            const codigo = fila.getElementsByTagName("td")[1].innerText.toLowerCase();
            const precio = fila.getElementsByTagName("td")[4].innerText.toLowerCase();

            if (nombre.includes(query) || codigo.includes(query) || precio.includes(query)) {
                fila.style.display = "";
            } else {
                fila.style.display = "none";
            }
        }
    }

    function cargarInventario() {
        const tbody = document.getElementById("inventario");
        tbody.innerHTML = "";

        productosAPI.forEach(producto => {
            const fila = document.createElement("tr");
            fila.innerHTML = 
                '<td><img src="' + producto.imagen + '" alt="' + producto.nombre + '" width="50"></td>' +
                '<td>' + producto.id + '</td>' +
                '<td>' + producto.nombre + '</td>' +
                '<td>' +
                    '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="decrease">-</button>' +
                    '<span id="cantidad-' + producto.id + '">0</span>' +
                    '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="increase">+</button>' +
                '</td>' +
                '<td>$' + producto.precio.toLocaleString() + ' COP</td>' +
                '<td>' + (producto.disponible ? "Disponible" : "Agotado") + '</td>';
            tbody.appendChild(fila);
        });

        asignarEventosBotones();
    }

    function asignarEventosBotones() {
        document.querySelectorAll(".adjust-quantity").forEach(button => {
            button.addEventListener("click", (event) => {
                const productId = event.target.dataset.product;
                const action = event.target.dataset.action;

                if (!cart[productId]) {
                    cart[productId] = 0;
                }

                if (action === "increase") {
                    cart[productId]++;
                    totalQuantity++;
                } else if (action === "decrease" && cart[productId] > 0) {
                    cart[productId]--;
                    totalQuantity--;
                }

                document.getElementById('cantidad-' + productId).innerText = cart[productId];
                  calcularTotal(); // Actualizar el total a pagar
              });
          });
      }
  
      // Evento para el buscador
      document.getElementById('search-input').addEventListener('input', (event) => {
          const query = event.target.value.toLowerCase();
          filtrarProductos(query);
      });
  
      // Evento para los radio buttons de entrega
      document.querySelectorAll('input[name="delivery-method"]').forEach(radio => {
          radio.addEventListener('change', (event) => {
              const form = document.getElementById('checkout-form');
              if (event.target.value === 'delivery') {
                  form.style.display = 'block';
              } else {
                  form.style.display = 'none';
              }
          });
      });
  
      // Cargar inventario al inicio
      cargarInventario();
  </script>
      </div>
  </body>
  </html>
  `;
  
    return new Response(htmlContent, {
      headers: { 'Content-Type': 'text/html' },
    });
  }





Inventario Aliexpress  Pagar con btc y ln umbrell

addEventListener('fetch', event => {
    event.respondWith(handleRequest(event.request));
  });
  
  async function handleRequest(request) {
    const htmlContent = `
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Worldwide Logistics Services.">
        <meta name="keywords" content="armenia quindio, compra, venta, clasificados, productos, Colombia, Contraentrega">
        <meta name="robots" content="index, follow">
        <meta name="author" content="Contraentrega">
        <meta property="og:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
        <meta property="og:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
        <meta property="og:image" content="URL-de-tu-imagen">
        <meta property="og:url" content="https://www.tusitio.com">
        <meta property="og:type" content="website">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
        <meta name="twitter:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
        <meta name="twitter:image" content="URL-de-tu-imagen">
        <meta name="twitter:url" content="https://www.tusitio.com">
        <meta name="google-site-verification" content="your-verification-code" />
  
        <!-- Facebook Pixel -->
        <script>
            !function(f,b,e,v,n,t,s)
            {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
            n.callMethod.apply(n,arguments):n.queue.push(arguments)};
            if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
            n.queue=[];t=b.createElement(e);t.async=!0;
            t.src=v;s=b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t,s)}(window, document,'script',
            'https://connect.facebook.net/en_US/fbevents.js');
            fbq('init', 'your-pixel-id');
            fbq('track', 'PageView');
        </script>
        <noscript>
            <img height="1" width="1" style="display:none"
            src="https://www.facebook.com/tr?id=your-pixel-id&ev=PageView&noscript=1"/>
        </noscript>
        <!-- End Facebook Pixel -->
  
        <title>@armeniaquindio - Compra y venta en Armenia Quindío</title>
  
        <!-- Datos estructurados con Schema.org -->
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.tusitio.com",
            "name": "@armeniaquindio",
            "description": "Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.",
            "publisher": {
                "@type": "Organization",
                "name": "Contraentrega Armenia Quindío"
            }
        }
        </script>
  
        <!-- Favicon -->
        <link rel="icon" href="URL-del-favicon" type="image/png">
  
        <!-- Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_TRACKING_ID"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'YOUR_TRACKING_ID');
        </script>
  
        <style>
            body {
                font-family: Arial, sans-serif;
                background-color: #f1f1f1;
                margin: 0;
                padding: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                text-align: center;
            }
            .container {
                background-color: #ffffff;
                border-radius: 8px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                width: 90%; 
                max-width: 600px; 
                padding: 20px;
                overflow-y: auto; 
                max-height: 80vh; 
                height: 100%; 
            }
            h1, h2 {
                font-size: 2.5em;
                color: #333;
                margin-bottom: 10px;
            }
            p {
                color: #666;
                font-size: 1.2em;
                margin-bottom: 20px;
            }
            .buttons a {
                display: block;
                background-color: #000000;
                color: white;
                padding: 10px;
                margin: 5px 0;
                text-decoration: none;
                border-radius: 5px;
                font-size: 1em;
                transition: background-color 0.3s;
            }
            .buttons a:hover {
                background-color: #333333;
            }
            .footer {
                font-size: 0.9em;
                color: #777;
                margin-top: 20px;
            }
            form {
                margin-top: 20px;
                text-align: left;
                margin-bottom: 20px;
            }
            input[type="text"], input[type="number"], textarea, select {
                width: 100%;
                padding: 10px;
                margin: 10px 0;
                border: 1px solid #ccc;
                border-radius: 5px;
            }
            input[type="file"] {
                margin: 10px 0;
            }
            button {
                background-color: #000000;
                color: white;
                padding: 10px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1.1em;
                width: 100%;
                margin: 5px 0;
            }
            button:hover {
                background-color: #333333;
            }
            table {
                width: 100%;
                margin-top: 30px;
                border-collapse: collapse;
                overflow-x: auto;
            }
            th, td {
                padding: 10px;
                text-align: left;
                border: 1px solid #ccc;
            }
            th {
                background-color: #f4f4f4;
            }
            td {
                background-color: #fafafa;
            }
            h2 {
                font-size: 1.8em;
                color: #333;
                margin-top: 20px;
            }
  
            .clickable {
                color: #007BFF;
                text-decoration: underline;
                cursor: pointer;
                transition: color 0.3s ease-in-out;
            }
  
            .clickable:hover {
                color: #0056b3;
                text-decoration: none;
            }
  
            /* Lazy loading de imágenes */
            img[loading="lazy"] {
                opacity: 0;
                transition: opacity 0.3s ease-in;
            }
            img[loading="lazy"]:not([src=""]) {
                opacity: 1;
            }
  
            /* Estilo para el total */
            .total {
                font-size: 1.5em;
                font-weight: bold;
                margin: 20px 0;
                color: #333;
            }
  
            /* Estilo para el buscador */
            .search-container {
                margin: 20px 0;
            }
            .search-container input {
                width: 100%;
                padding: 10px;
                border: 1px solid #ccc;
                border-radius: 5px;
            }
  
            /* Estilo para los radio buttons */
            .radio-group {
                display: flex;
                gap: 10px;
                margin: 10px 0;
            }
            .radio-group label {
                display: flex;
                align-items: center;
                gap: 5px;
            }
        </style>
    </head>
  
    <body>
  
        <div class="container">
            <header>
                <h1>@bodegascali</h1>
                <p>Punto: Vereda Campoalegre, Oeste Cali, Valle, Colombia</p>
            </header>
  
            <!-- Botones de contacto -->
            <div class="buttons">
                <a href="tel:+573001234567" id="llamar-btn">📞 Llamar</a>
                <a href="https://wa.me/573001234567" target="_blank" id="mensaje-btn">💬 Enviar mensaje</a>
            </div>
  
            <section>
                <p>CÓDIGO: 1</p>
  
                <!-- SKU #1 -->
                <div class="video-container">
                    <iframe 
                        src="https://www.youtube.com/embed/4J59H-M9iBY" 
                        title="YouTube video player" 
                        frameborder="0" 
                        allow="autoplay; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                </div>
  
                <!-- Buscador -->
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Buscar productos por nombre, código o precio...">
                </div>
  
                <!-- Inventario -->
                <section>
                    <h2>Inventario</h2>
                    <table border="1">
                        <thead>
                            <tr>
                                <th>Imagen</th>
                                <th>Código</th>
                                <th>Nombre</th>
                                <th>Ajustar Cantidad</th>
                                <th>Precio Unitario</th>
                                <th>Disponibilidad</th>
                            </tr>
                        </thead>
                        <tbody id="inventario">
                            <!-- Los productos se insertarán aquí dinámicamente -->
                        </tbody>
                    </table>
                </section>
  
                <!-- Checkout -->
                <section>
                    <h2>Checkout</h2>
  
                    <!-- Opciones de entrega -->
                    <h3>Selecciona el método de entrega</h3>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="delivery-method" value="pickup" checked> Recoger en el punto
                        </label>
                        <label>
                            <input type="radio" name="delivery-method" value="delivery"> Servicio a domicilio
                        </label>
                    </div>
  
                    <!-- Total a pagar -->
                    <div class="total">
                        Total a pagar: <span id="total-pagar">$0 COP</span>
                    </div>
  
                    <!-- Métodos de pago -->
                    <h3>Método de pago</h3>
                    <div>
                        <button type="button" id="pay-lightning">Pagar con Lightning</button>
                        <button type="button" id="pay-btc">Pagar con BTC</button>
                    </div>
  
                    <!-- Formulario de envío (oculto por defecto) -->
                    <form id="checkout-form" style="display: none;">
                        <h3>Información de envío</h3>
                        <input type="text" name="name" placeholder="Nombre completo" required>
                        <input type="email" name="email" placeholder="Correo electrónico" required>
                        <input type="text" name="address" placeholder="Dirección de envío" required>
                        <input type="text" name="city" placeholder="Ciudad" required>
                        <input type="text" name="state" placeholder="Departamento" required>
                        <input type="text" name="zip" placeholder="Código postal" required>
                        <select name="shipping-method" required>
                            <option value="" disabled selected>Selecciona un método de envío</option>
                            <option value="standard">Envío estándar (5-7 días)</option>
                            <option value="express">Envío express (1-2 días)</option>
                        </select>
                    </form>
                </section>
  
                <!-- Footer -->
                <footer class="footer">
                    <p>&copy; 2025 Contraentrega - Todos los derechos reservados</p>
                    <p><a href="https://www.tusitio.com/privacy" class="clickable">Política de privacidad</a> | <a href="https://www.tusitio.com/terms" class="clickable">Términos y condiciones</a></p>
                </footer>
            </div>
  
            <script>
        let cart = {}; // Objeto para almacenar los productos en el carrito
        let totalQuantity = 0; // Total de productos en el carrito
        let totalAmount = 0; // Total a pagar
  
        // Función para obtener productos de AliExpress
        async function obtenerProductos() {
            const response = await fetch('https://api.aliexpress.com/rest/v1/products', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer YOUR_ALIEXPRESS_API_KEY',
                    'Content-Type': 'application/json'
                }
            });
            const data = await response.json();
            return data.products;
        }
  
        // Función para calcular el total a pagar
        function calcularTotal() {
            totalAmount = 0;
            productosAPI.forEach(producto => {
                if (cart[producto.id]) {
                    totalAmount += producto.precio * cart[producto.id];
                }
            });
            document.getElementById('total-pagar').innerText = '$' + totalAmount.toLocaleString() + ' COP';
        }
  
        // Función para validar el formulario de envío
        function validarFormulario() {
            const form = document.getElementById('checkout-form');
            const inputs = form.querySelectorAll('input, select');
            let valido = true;
  
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    valido = false;
                    input.style.border = '1px solid red';
                } else {
                    input.style.border = '1px solid #ccc';
                }
            });
  
            return valido;
        }
  
        // Función para manejar el pago con Lightning (Umbrel)
        async function pagarConLightning() {
            if (document.querySelector('input[name="delivery-method"]:checked').value === 'delivery' && !validarFormulario()) {
                alert('Por favor, completa todos los campos del formulario de envío.');
                return;
            }
  
            // Obtener el monto total a pagar
            const total = totalAmount; // totalAmount se calcula en la función calcularTotal()
  
            // Crear una factura Lightning usando la API de LNbits en Umbrel
            const response = await fetch('http://<IP-de-tu-umbrel>/lnbits/api/v1/payments', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Api-Key': 'tu-api-key-de-lnbits' // Reemplaza con tu API key de LNbits
                },
                body: JSON.stringify({
                    out: false,
                    amount: total,
                    memo: 'Pago desde @bodegascali'
                })
            });
            const data = await response.json();
  
            if (data.payment_request) {
                // Mostrar la factura Lightning al usuario
                alert('Escanea este código QR para pagar: ' + data.payment_request);
                // Redirigir a una página de confirmación de pago
                window.location.href = 'http://<IP-de-tu-umbrel>/lnbits/invoice/' + data.payment_hash;
  
                // Realizar la compra en AliExpress
                await realizarCompraAliExpress();
                // Notificar al cliente por correo electrónico
                await notificarCliente();
            } else {
                alert('Error al generar la factura Lightning.');
            }
        }
  
        // Función para manejar el pago con Bitcoin (BTC)
        async function pagarConBTC() {
            if (document.querySelector('input[name="delivery-method"]:checked').value === 'delivery' && !validarFormulario()) {
                alert('Por favor, completa todos los campos del formulario de envío.');
                return;
            }
  
            // Obtener el monto total a pagar
            const total = totalAmount; // totalAmount se calcula en la función calcularTotal()
  
            // Generar una dirección Bitcoin usando la API de Bitcoin Core en Umbrel
            const response = await fetch('http://<IP-de-tu-umbrel>/bitcoin/api/v1/getnewaddress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + btoa('usuario:contraseña') // Reemplaza con tus credenciales de Bitcoin Core
                }
            });
            const data = await response.json();
  
            if (data.address) {
                // Mostrar la dirección Bitcoin al usuario
                alert('Envía ' + (total / 100000000) + ' BTC a la siguiente dirección: ' + data.address);
                // Redirigir a una página de confirmación de pago
                window.location.href = 'http://<IP-de-tu-umbrel>/bitcoin/address/' + data.address;
  
                // Realizar la compra en AliExpress
                await realizarCompraAliExpress();
                // Notificar al cliente por correo electrónico
                await notificarCliente();
            } else {
                alert('Error al generar la dirección Bitcoin.');
            }
        }
  
        // Función para realizar la compra en AliExpress
        async function realizarCompraAliExpress() {
            const productos = Object.keys(cart).map(id => ({
                productId: id,
                quantity: cart[id]
            }));
  
            const response = await fetch('https://api.aliexpress.com/rest/v1/orders', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer YOUR_ALIEXPRESS_API_KEY',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    products: productos
                })
            });
  
            if (response.ok) {
                console.log('Compra realizada con éxito en AliExpress');
            } else {
                console.error('Error al realizar la compra en AliExpress');
            }
        }
  
        // Función para notificar al cliente por correo electrónico
        async function notificarCliente() {
            const email = document.querySelector('input[name="email"]').value;
            const response = await fetch('https://api.sendgrid.com/v3/mail/send', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer YOUR_SENDGRID_API_KEY',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    personalizations: [{
                        to: [{ email: email }],
                        subject: 'Confirmación de compra'
                    }],
                    from: { email: 'no-reply@tusitio.com' },
                    content: [{
                        type: 'text/plain',
                        value: 'Gracias por tu compra. Tu pedido ha sido procesado con éxito.'
                    }]
                })
            });
  
            if (response.ok) {
                console.log('Correo electrónico enviado con éxito');
            } else {
                console.error('Error al enviar el correo electrónico');
            }
        }
  
        // Asignar eventos a los botones de pago
        document.getElementById('pay-lightning').addEventListener('click', pagarConLightning);
        document.getElementById('pay-btc').addEventListener('click', pagarConBTC);
    
        // Función para filtrar productos en la tabla
        function filtrarProductos(query) {
            const tbody = document.getElementById("inventario");
            const filas = tbody.getElementsByTagName("tr");
  
            for (let fila of filas) {
                const nombre = fila.getElementsByTagName("td")[2].innerText.toLowerCase();
                const codigo = fila.getElementsByTagName("td")[1].innerText.toLowerCase();
                const precio = fila.getElementsByTagName("td")[4].innerText.toLowerCase();
  
                if (nombre.includes(query) || codigo.includes(query) || precio.includes(query)) {
                    fila.style.display = "";
                } else {
                    fila.style.display = "none";
                }
            }
        }
  
        // Renderizar productos dinámicamente dentro de la tabla
        async function cargarInventario() {
            const tbody = document.getElementById("inventario");
            tbody.innerHTML = ""; // Limpiar la tabla antes de renderizar
  
            const productosAPI = await obtenerProductos();
  
            productosAPI.forEach(producto => {
                const fila = document.createElement("tr");
                fila.innerHTML = 
                    '<td><img src="' + producto.imagen + '" alt="' + producto.nombre + '" width="50"></td>' +
                    '<td>' + producto.id + '</td>' +
                    '<td>' + producto.nombre + '</td>' +
                    '<td>' +
                        '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="decrease">-</button>' +
                        '<span id="cantidad-' + producto.id + '">0</span>' +
                        '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="increase">+</button>' +
                    '</td>' +
                    '<td>$' + producto.precio.toLocaleString() + ' COP</td>' +
                    '<td>' + (producto.disponible ? "Disponible" : "Agotado") + '</td>';
                tbody.appendChild(fila);
            });
  
            asignarEventosBotones();
        }
  
        // Asignar eventos a los botones de ajuste de cantidad
        function asignarEventosBotones() {
            document.querySelectorAll(".adjust-quantity").forEach(button => {
                button.addEventListener("click", (event) => {
                    const productId = event.target.dataset.product;
                    const action = event.target.dataset.action;
  
                    if (!cart[productId]) {
                        cart[productId] = 0;
                    }
  
                    if (action === "increase") {
                        cart[productId]++;
                        totalQuantity++;
                    } else if (action === "decrease" && cart[productId] > 0) {
                        cart[productId]--;
                        totalQuantity--;
                    }
  
                    document.getElementById('cantidad-' + productId).innerText = cart[productId];
                    calcularTotal(); // Actualizar el total a pagar
                });
            });
        }
  
        // Evento para el buscador
        document.getElementById('search-input').addEventListener('input', (event) => {
            const query = event.target.value.toLowerCase();
            filtrarProductos(query);
        });
  
        // Evento para los radio buttons de entrega
        document.querySelectorAll('input[name="delivery-method"]').forEach(radio => {
            radio.addEventListener('change', (event) => {
                const form = document.getElementById('checkout-form');
                if (event.target.value === 'delivery') {
                    form.style.display = 'block';
                } else {
                    form.style.display = 'none';
                }
            });
        });
  
        // Cargar inventario al inicio
        cargarInventario();
    </script>
        </div>
    </body>
    </html>
    `;
  
      return new Response(htmlContent, {
        headers: { 'Content-Type': 'text/html' },
      });
    }


Inventario manual  pago por btc y ln 

addEventListener('fetch', event => {
    event.respondWith(handleRequest(event.request))
  })
  
  async function handleRequest(request) {
    const htmlContent = `
  <!DOCTYPE html>
  <html lang="es">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="Worldwide Logistics Services.">
      <meta name="keywords" content="armenia quindio, compra, venta, clasificados, productos, Colombia, Contraentrega">
      <meta name="robots" content="index, follow">
      <meta name="author" content="Contraentrega">
      <meta property="og:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
      <meta property="og:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
      <meta property="og:image" content="URL-de-tu-imagen">
      <meta property="og:url" content="https://www.tusitio.com">
      <meta property="og:type" content="website">
      <meta name="twitter:card" content="summary_large_image">
      <meta name="twitter:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
      <meta name="twitter:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
      <meta name="twitter:image" content="URL-de-tu-imagen">
      <meta name="twitter:url" content="https://www.tusitio.com">
      <meta name="google-site-verification" content="your-verification-code" />
  
      <!-- Facebook Pixel -->
      <script>
          !function(f,b,e,v,n,t,s)
          {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
          n.callMethod.apply(n,arguments):n.queue.push(arguments)};
          if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
          n.queue=[];t=b.createElement(e);t.async=!0;
          t.src=v;s=b.getElementsByTagName(e)[0];
          s.parentNode.insertBefore(t,s)}(window, document,'script',
          'https://connect.facebook.net/en_US/fbevents.js');
          fbq('init', 'your-pixel-id');
          fbq('track', 'PageView');
      </script>
      <noscript>
          <img height="1" width="1" style="display:none"
          src="https://www.facebook.com/tr?id=your-pixel-id&ev=PageView&noscript=1"/>
      </noscript>
      <!-- End Facebook Pixel -->
  
      <title>@armeniaquindio - Compra y venta en Armenia Quindío</title>
  
      <!-- Datos estructurados con Schema.org -->
      <script type="application/ld+json">
      {
          "@context": "https://schema.org",
          "@type": "WebSite",
          "url": "https://www.tusitio.com",
          "name": "@armeniaquindio",
          "description": "Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.",
          "publisher": {
              "@type": "Organization",
              "name": "Contraentrega Armenia Quindío"
          }
      }
      </script>
  
      <!-- Favicon -->
      <link rel="icon" href="URL-del-favicon" type="image/png">
  
      <!-- Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_TRACKING_ID"></script>
      <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'YOUR_TRACKING_ID');
      </script>
  
      <style>
          body {
              font-family: Arial, sans-serif;
              background-color: #f1f1f1;
              margin: 0;
              padding: 0;
              display: flex;
              justify-content: center;
              align-items: center;
              height: 100vh;
              text-align: center;
          }
          .container {
              background-color: #ffffff;
              border-radius: 8px;
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
              width: 90%; 
              max-width: 600px; 
              padding: 20px;
              overflow-y: auto; 
              max-height: 80vh; 
              height: 100%; 
          }
          h1, h2 {
              font-size: 2.5em;
              color: #333;
              margin-bottom: 10px;
          }
          p {
              color: #666;
              font-size: 1.2em;
              margin-bottom: 20px;
          }
          .buttons a {
              display: block;
              background-color: #000000;
              color: white;
              padding: 10px;
              margin: 5px 0;
              text-decoration: none;
              border-radius: 5px;
              font-size: 1em;
              transition: background-color 0.3s;
          }
          .buttons a:hover {
              background-color: #333333;
          }
          .footer {
              font-size: 0.9em;
              color: #777;
              margin-top: 20px;
          }
          form {
              margin-top: 20px;
              text-align: left;
              margin-bottom: 20px;
          }
          input[type="text"], input[type="number"], textarea, select {
              width: 100%;
              padding: 10px;
              margin: 10px 0;
              border: 1px solid #ccc;
              border-radius: 5px;
          }
          input[type="file"] {
              margin: 10px 0;
          }
          button {
              background-color: #000000;
              color: white;
              padding: 10px;
              border: none;
              border-radius: 5px;
              cursor: pointer;
              font-size: 1.1em;
              width: 100%;
              margin: 5px 0;
          }
          button:hover {
              background-color: #333333;
          }
          table {
              width: 100%;
              margin-top: 30px;
              border-collapse: collapse;
              overflow-x: auto;
          }
          th, td {
              padding: 10px;
              text-align: left;
              border: 1px solid #ccc;
          }
          th {
              background-color: #f4f4f4;
          }
          td {
              background-color: #fafafa;
          }
          h2 {
              font-size: 1.8em;
              color: #333;
              margin-top: 20px;
          }
  
          .clickable {
              color: #007BFF;
              text-decoration: underline;
              cursor: pointer;
              transition: color 0.3s ease-in-out;
          }
  
          .clickable:hover {
              color: #0056b3;
              text-decoration: none;
          }
  
          /* Lazy loading de imágenes */
          img[loading="lazy"] {
              opacity: 0;
              transition: opacity 0.3s ease-in;
          }
          img[loading="lazy"]:not([src=""]) {
              opacity: 1;
          }
  
          /* Estilo para el total */
          .total {
              font-size: 1.5em;
              font-weight: bold;
              margin: 20px 0;
              color: #333;
          }
  
          /* Estilo para el buscador */
          .search-container {
              margin: 20px 0;
          }
          .search-container input {
              width: 100%;
              padding: 10px;
              border: 1px solid #ccc;
              border-radius: 5px;
          }
  
          /* Estilo para los radio buttons */
          .radio-group {
              display: flex;
              gap: 10px;
              margin: 10px 0;
          }
          .radio-group label {
              display: flex;
              align-items: center;
              gap: 5px;
          }
      </style>
  </head>
  
  <body>
  
      <div class="container">
          <header>
              <h1>@bodegascali</h1>
              <p>Punto: Vereda Campoalegre, Oeste Cali, Valle, Colombia</p>
          </header>
  
          <!-- Botones de contacto -->
          <div class="buttons">
              <a href="tel:+573001234567" id="llamar-btn">📞 Llamar</a>
              <a href="https://wa.me/573001234567" target="_blank" id="mensaje-btn">💬 Enviar mensaje</a>
          </div>
  
          <section>
              <p>CÓDIGO: 1</p>
  
              <!-- SKU #1 -->
              <div class="video-container">
                  <iframe 
                      src="https://www.youtube.com/embed/4J59H-M9iBY" 
                      title="YouTube video player" 
                      frameborder="0" 
                      allow="autoplay; encrypted-media; gyroscope; picture-in-picture" 
                      allowfullscreen>
                  </iframe>
              </div>
  
              <!-- Buscador -->
              <div class="search-container">
                  <input type="text" id="search-input" placeholder="Buscar productos por nombre, código o precio...">
              </div>
  
              <!-- Inventario -->
              <section>
                  <h2>Inventario</h2>
                  <table border="1">
                      <thead>
                          <tr>
                              <th>Imagen</th>
                              <th>Código</th>
                              <th>Nombre</th>
                              <th>Ajustar Cantidad</th>
                              <th>Precio Unitario</th>
                              <th>Disponibilidad</th>
                          </tr>
                      </thead>
                      <tbody id="inventario">
                          <!-- Los productos se insertarán aquí dinámicamente -->
                      </tbody>
                  </table>
              </section>
  
              <!-- Checkout -->
              <section>
                  <h2>Checkout</h2>
  
                  <!-- Opciones de entrega -->
                  <h3>Selecciona el método de entrega</h3>
                  <div class="radio-group">
                      <label>
                          <input type="radio" name="delivery-method" value="pickup" checked> Recoger en el punto
                      </label>
                      <label>
                          <input type="radio" name="delivery-method" value="delivery"> Servicio a domicilio
                      </label>
                  </div>
  
                  <!-- Total a pagar -->
                  <div class="total">
                      Total a pagar: <span id="total-pagar">$0 COP</span>
                  </div>
  
                  <!-- Métodos de pago -->
                  <h3>Método de pago</h3>
                  <div>
                      <button type="button" id="pay-lightning">Pagar con Lightning</button>
                      <button type="button" id="pay-btc">Pagar con BTC</button>
                  </div>
  
                  <!-- Formulario de envío (oculto por defecto) -->
                  <form id="checkout-form" style="display: none;">
                      <h3>Información de envío</h3>
                      <input type="text" name="name" placeholder="Nombre completo" required>
                      <input type="email" name="email" placeholder="Correo electrónico" required>
                      <input type="text" name="address" placeholder="Dirección de envío" required>
                      <input type="text" name="city" placeholder="Ciudad" required>
                      <input type="text" name="state" placeholder="Departamento" required>
                      <input type="text" name="zip" placeholder="Código postal" required>
                      <select name="shipping-method" required>
                          <option value="" disabled selected>Selecciona un método de envío</option>
                          <option value="standard">Envío estándar (5-7 días)</option>
                          <option value="express">Envío express (1-2 días)</option>
                      </select>
                  </form>
              </section>
  
              <!-- Footer -->
              <footer class="footer">
                  <p>&copy; 2025 Contraentrega - Todos los derechos reservados</p>
                  <p><a href="https://www.tusitio.com/privacy" class="clickable">Política de privacidad</a> | <a href="https://www.tusitio.com/terms" class="clickable">Términos y condiciones</a></p>
              </footer>
          </div>
  
          <script>
      let cart = {}; // Objeto para almacenar los productos en el carrito
      let totalQuantity = 0; // Total de productos en el carrito
      let totalAmount = 0; // Total a pagar
  
      // Simulación de API de productos
      const productosAPI = [
          { id: "P001", nombre: "Laptop", precio: 2500000, disponible: true, imagen: "https://via.placeholder.com/50" },
          { id: "P002", nombre: "Mouse Gamer", precio: 120000, disponible: true, imagen: "https://via.placeholder.com/50" },
          { id: "P003", nombre: "Teclado Mecánico", precio: 350000, disponible: false, imagen: "https://via.placeholder.com/50" }
      ];
  
      // Función para calcular el total a pagar
      function calcularTotal() {
          totalAmount = 0;
          productosAPI.forEach(producto => {
              if (cart[producto.id]) {
                  totalAmount += producto.precio * cart[producto.id];
              }
          });
          document.getElementById('total-pagar').innerText = '$' + totalAmount.toLocaleString() + ' COP';
      }
  
      // Función para validar el formulario de envío
      function validarFormulario() {
          const form = document.getElementById('checkout-form');
          const inputs = form.querySelectorAll('input, select');
          let valido = true;
  
          inputs.forEach(input => {
              if (!input.value.trim()) {
                  valido = false;
                  input.style.border = '1px solid red';
              } else {
                  input.style.border = '1px solid #ccc';
              }
          });
  
          return valido;
      }
  
      // Función para manejar el pago con Lightning (Umbrel)
function pagarConLightning() {
    if (document.querySelector('input[name="delivery-method"]:checked').value === 'delivery' && !validarFormulario()) {
        alert('Por favor, completa todos los campos del formulario de envío.');
        return;
    }

    // Obtener el monto total a pagar
    const total = totalAmount; // totalAmount se calcula en la función calcularTotal()

    // Crear una factura Lightning usando la API de LNbits en Umbrel
    fetch('http://<IP-de-tu-umbrel>/lnbits/api/v1/payments', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Api-Key': 'tu-api-key-de-lnbits' // Reemplaza con tu API key de LNbits
        },
        body: JSON.stringify({
            out: false,
            amount: total,
            memo: 'Pago desde @bodegascali'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.payment_request) {
            // Mostrar la factura Lightning al usuario
            alert('Escanea este código QR para pagar: ' + data.payment_request);
            // Redirigir a una página de confirmación de pago
            window.location.href = 'http://<IP-de-tu-umbrel>/lnbits/invoice/' + data.payment_hash;
        } else {
            alert('Error al generar la factura Lightning.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error al conectar con el servidor de pagos.');
    });
}

// Función para manejar el pago con Bitcoin (BTC)
function pagarConBTC() {
    if (document.querySelector('input[name="delivery-method"]:checked').value === 'delivery' && !validarFormulario()) {
        alert('Por favor, completa todos los campos del formulario de envío.');
        return;
    }

    // Obtener el monto total a pagar
    const total = totalAmount; // totalAmount se calcula en la función calcularTotal()

    // Generar una dirección Bitcoin usando la API de Bitcoin Core en Umbrel
    fetch('http://<IP-de-tu-umbrel>/bitcoin/api/v1/getnewaddress', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Basic ' + btoa('usuario:contraseña') // Reemplaza con tus credenciales de Bitcoin Core
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.address) {
            // Mostrar la dirección Bitcoin al usuario
            alert('Envía ' + (total / 100000000) + ' BTC a la siguiente dirección: ' + data.address);
            // Redirigir a una página de confirmación de pago
            window.location.href = 'http://<IP-de-tu-umbrel>/bitcoin/address/' + data.address;
        } else {
            alert('Error al generar la dirección Bitcoin.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error al conectar con el servidor de pagos.');
    });
}

// Asignar eventos a los botones de pago
document.getElementById('pay-lightning').addEventListener('click', pagarConLightning);
document.getElementById('pay-btc').addEventListener('click', pagarConBTC);
  
      // Función para filtrar productos en la tabla
      function filtrarProductos(query) {
          const tbody = document.getElementById("inventario");
          const filas = tbody.getElementsByTagName("tr");
  
          for (let fila of filas) {
              const nombre = fila.getElementsByTagName("td")[2].innerText.toLowerCase();
              const codigo = fila.getElementsByTagName("td")[1].innerText.toLowerCase();
              const precio = fila.getElementsByTagName("td")[4].innerText.toLowerCase();
  
              if (nombre.includes(query) || codigo.includes(query) || precio.includes(query)) {
                  fila.style.display = "";
              } else {
                  fila.style.display = "none";
              }
          }
      }
  
      // Renderizar productos dinámicamente dentro de la tabla
      function cargarInventario() {
          const tbody = document.getElementById("inventario");
          tbody.innerHTML = ""; // Limpiar la tabla antes de renderizar
  
          productosAPI.forEach(producto => {
              const fila = document.createElement("tr");
              fila.innerHTML = 
                  '<td><img src="' + producto.imagen + '" alt="' + producto.nombre + '" width="50"></td>' +
                  '<td>' + producto.id + '</td>' +
                  '<td>' + producto.nombre + '</td>' +
                  '<td>' +
                      '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="decrease">-</button>' +
                      '<span id="cantidad-' + producto.id + '">0</span>' +
                      '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="increase">+</button>' +
                  '</td>' +
                  '<td>$' + producto.precio.toLocaleString() + ' COP</td>' +
                  '<td>' + (producto.disponible ? "Disponible" : "Agotado") + '</td>';
              tbody.appendChild(fila);
          });
  
          asignarEventosBotones();
      }
  
      // Asignar eventos a los botones de ajuste de cantidad
      function asignarEventosBotones() {
          document.querySelectorAll(".adjust-quantity").forEach(button => {
              button.addEventListener("click", (event) => {
                  const productId = event.target.dataset.product;
                  const action = event.target.dataset.action;
  
                  if (!cart[productId]) {
                      cart[productId] = 0;
                  }
  
                  if (action === "increase") {
                      cart[productId]++;
                      totalQuantity++;
                  } else if (action === "decrease" && cart[productId] > 0) {
                      cart[productId]--;
                      totalQuantity--;
                  }
  
                  document.getElementById('cantidad-' + productId).innerText = cart[productId];
                  calcularTotal(); // Actualizar el total a pagar
              });
          });
      }
  
      // Evento para el buscador
      document.getElementById('search-input').addEventListener('input', (event) => {
          const query = event.target.value.toLowerCase();
          filtrarProductos(query);
      });
  
      // Evento para los radio buttons de entrega
      document.querySelectorAll('input[name="delivery-method"]').forEach(radio => {
          radio.addEventListener('change', (event) => {
              const form = document.getElementById('checkout-form');
              if (event.target.value === 'delivery') {
                  form.style.display = 'block';
              } else {
                  form.style.display = 'none';
              }
          });
      });
  
      // Cargar inventario al inicio
      cargarInventario();
  </script>
      </div>
  </body>
  </html>
  `;
  
    return new Response(htmlContent, {
      headers: { 'Content-Type': 'text/html' },
    });
  }


inventario manual  btc y ln zeus wallet android

addEventListener('fetch', event => {
    event.respondWith(handleRequest(event.request))
  })
  
  async function handleRequest(request) {
    const htmlContent = `
  <!DOCTYPE html>
  <html lang="es">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="Worldwide Logistics Services.">
      <meta name="keywords" content="armenia quindio, compra, venta, clasificados, productos, Colombia, Contraentrega">
      <meta name="robots" content="index, follow">
      <meta name="author" content="Contraentrega">
      <meta property="og:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
      <meta property="og:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
      <meta property="og:image" content="URL-de-tu-imagen">
      <meta property="og:url" content="https://www.tusitio.com">
      <meta property="og:type" content="website">
      <meta name="twitter:card" content="summary_large_image">
      <meta name="twitter:title" content="@armeniaquindio - Compra y venta en Armenia Quindío">
      <meta name="twitter:description" content="Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.">
      <meta name="twitter:image" content="URL-de-tu-imagen">
      <meta name="twitter:url" content="https://www.tusitio.com">
      <meta name="google-site-verification" content="your-verification-code" />
  
      <!-- Facebook Pixel -->
      <script>
          !function(f,b,e,v,n,t,s)
          {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
          n.callMethod.apply(n,arguments):n.queue.push(arguments)};
          if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
          n.queue=[];t=b.createElement(e);t.async=!0;
          t.src=v;s=b.getElementsByTagName(e)[0];
          s.parentNode.insertBefore(t,s)}(window, document,'script',
          'https://connect.facebook.net/en_US/fbevents.js');
          fbq('init', 'your-pixel-id');
          fbq('track', 'PageView');
      </script>
      <noscript>
          <img height="1" width="1" style="display:none"
          src="https://www.facebook.com/tr?id=your-pixel-id&ev=PageView&noscript=1"/>
      </noscript>
      <!-- End Facebook Pixel -->
  
      <title>@armeniaquindio - Compra y venta en Armenia Quindío</title>
  
      <!-- Datos estructurados con Schema.org -->
      <script type="application/ld+json">
      {
          "@context": "https://schema.org",
          "@type": "WebSite",
          "url": "https://www.tusitio.com",
          "name": "@armeniaquindio",
          "description": "Compra y venta en Armenia Quindío, Colombia. Publica tus productos en Contraentrega.",
          "publisher": {
              "@type": "Organization",
              "name": "Contraentrega Armenia Quindío"
          }
      }
      </script>
  
      <!-- Favicon -->
      <link rel="icon" href="URL-del-favicon" type="image/png">
  
      <!-- Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_TRACKING_ID"></script>
      <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'YOUR_TRACKING_ID');
      </script>
  
      <style>
          body {
              font-family: Arial, sans-serif;
              background-color: #f1f1f1;
              margin: 0;
              padding: 0;
              display: flex;
              justify-content: center;
              align-items: center;
              height: 100vh;
              text-align: center;
          }
          .container {
              background-color: #ffffff;
              border-radius: 8px;
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
              width: 90%; 
              max-width: 600px; 
              padding: 20px;
              overflow-y: auto; 
              max-height: 80vh; 
              height: 100%; 
          }
          h1, h2 {
              font-size: 2.5em;
              color: #333;
              margin-bottom: 10px;
          }
          p {
              color: #666;
              font-size: 1.2em;
              margin-bottom: 20px;
          }
          .buttons a {
              display: block;
              background-color: #000000;
              color: white;
              padding: 10px;
              margin: 5px 0;
              text-decoration: none;
              border-radius: 5px;
              font-size: 1em;
              transition: background-color 0.3s;
          }
          .buttons a:hover {
              background-color: #333333;
          }
          .footer {
              font-size: 0.9em;
              color: #777;
              margin-top: 20px;
          }
          form {
              margin-top: 20px;
              text-align: left;
              margin-bottom: 20px;
          }
          input[type="text"], input[type="number"], textarea, select {
              width: 100%;
              padding: 10px;
              margin: 10px 0;
              border: 1px solid #ccc;
              border-radius: 5px;
          }
          input[type="file"] {
              margin: 10px 0;
          }
          button {
              background-color: #000000;
              color: white;
              padding: 10px;
              border: none;
              border-radius: 5px;
              cursor: pointer;
              font-size: 1.1em;
              width: 100%;
              margin: 5px 0;
          }
          button:hover {
              background-color: #333333;
          }
          table {
              width: 100%;
              margin-top: 30px;
              border-collapse: collapse;
              overflow-x: auto;
          }
          th, td {
              padding: 10px;
              text-align: left;
              border: 1px solid #ccc;
          }
          th {
              background-color: #f4f4f4;
          }
          td {
              background-color: #fafafa;
          }
          h2 {
              font-size: 1.8em;
              color: #333;
              margin-top: 20px;
          }
  
          .clickable {
              color: #007BFF;
              text-decoration: underline;
              cursor: pointer;
              transition: color 0.3s ease-in-out;
          }
  
          .clickable:hover {
              color: #0056b3;
              text-decoration: none;
          }
  
          /* Lazy loading de imágenes */
          img[loading="lazy"] {
              opacity: 0;
              transition: opacity 0.3s ease-in;
          }
          img[loading="lazy"]:not([src=""]) {
              opacity: 1;
          }
  
          /* Estilo para el total */
          .total {
              font-size: 1.5em;
              font-weight: bold;
              margin: 20px 0;
              color: #333;
          }
  
          /* Estilo para el buscador */
          .search-container {
              margin: 20px 0;
          }
          .search-container input {
              width: 100%;
              padding: 10px;
              border: 1px solid #ccc;
              border-radius: 5px;
          }
  
          /* Estilo para los radio buttons */
          .radio-group {
              display: flex;
              gap: 10px;
              margin: 10px 0;
          }
          .radio-group label {
              display: flex;
              align-items: center;
              gap: 5px;
          }
      </style>
  </head>
  
  <body>
  
      <div class="container">
          <header>
              <h1>@bodegascali</h1>
              <p>Punto: Vereda Campoalegre, Oeste Cali, Valle, Colombia</p>
          </header>
  
          <!-- Botones de contacto -->
          <div class="buttons">
              <a href="tel:+573001234567" id="llamar-btn">📞 Llamar</a>
              <a href="https://wa.me/573001234567" target="_blank" id="mensaje-btn">💬 Enviar mensaje</a>
          </div>
  
          <section>
              <p>CÓDIGO: 1</p>
  
              <!-- SKU #1 -->
              <div class="video-container">
                  <iframe 
                      src="https://www.youtube.com/embed/4J59H-M9iBY" 
                      title="YouTube video player" 
                      frameborder="0" 
                      allow="autoplay; encrypted-media; gyroscope; picture-in-picture" 
                      allowfullscreen>
                  </iframe>
              </div>
  
              <!-- Buscador -->
              <div class="search-container">
                  <input type="text" id="search-input" placeholder="Buscar productos por nombre, código o precio...">
              </div>
  
              <!-- Inventario -->
              <section>
                  <h2>Inventario</h2>
                  <table border="1">
                      <thead>
                          <tr>
                              <th>Imagen</th>
                              <th>Código</th>
                              <th>Nombre</th>
                              <th>Ajustar Cantidad</th>
                              <th>Precio Unitario</th>
                              <th>Disponibilidad</th>
                          </tr>
                      </thead>
                      <tbody id="inventario">
                          <!-- Los productos se insertarán aquí dinámicamente -->
                      </tbody>
                  </table>
              </section>
  
              <!-- Checkout -->
              <section>
                  <h2>Checkout</h2>
  
                  <!-- Opciones de entrega -->
                  <h3>Selecciona el método de entrega</h3>
                  <div class="radio-group">
                      <label>
                          <input type="radio" name="delivery-method" value="pickup" checked> Recoger en el punto
                      </label>
                      <label>
                          <input type="radio" name="delivery-method" value="delivery"> Servicio a domicilio
                      </label>
                  </div>
  
                  <!-- Total a pagar -->
                  <div class="total">
                      Total a pagar: <span id="total-pagar">$0 COP</span>
                  </div>
  
                  <!-- Métodos de pago -->
                  <h3>Método de pago</h3>
                  <div>
                      <button type="button" id="pay-lightning">Pagar con Lightning</button>
                      <button type="button" id="pay-btc">Pagar con BTC</button>
                  </div>
  
                  <!-- Formulario de envío (oculto por defecto) -->
                  <form id="checkout-form" style="display: none;">
                      <h3>Información de envío</h3>
                      <input type="text" name="name" placeholder="Nombre completo" required>
                      <input type="email" name="email" placeholder="Correo electrónico" required>
                      <input type="text" name="address" placeholder="Dirección de envío" required>
                      <input type="text" name="city" placeholder="Ciudad" required>
                      <input type="text" name="state" placeholder="Departamento" required>
                      <input type="text" name="zip" placeholder="Código postal" required>
                      <select name="shipping-method" required>
                          <option value="" disabled selected>Selecciona un método de envío</option>
                          <option value="standard">Envío estándar (5-7 días)</option>
                          <option value="express">Envío express (1-2 días)</option>
                      </select>
                  </form>
              </section>
  
              <!-- Footer -->
              <footer class="footer">
                  <p>&copy; 2025 Contraentrega - Todos los derechos reservados</p>
                  <p><a href="https://www.tusitio.com/privacy" class="clickable">Política de privacidad</a> | <a href="https://www.tusitio.com/terms" class="clickable">Términos y condiciones</a></p>
              </footer>
          </div>
  
          <script>
      let cart = {}; // Objeto para almacenar los productos en el carrito
      let totalQuantity = 0; // Total de productos en el carrito
      let totalAmount = 0; // Total a pagar
  
      // Simulación de API de productos
      const productosAPI = [
          { id: "P001", nombre: "Laptop", precio: 2500000, disponible: true, imagen: "https://via.placeholder.com/50" },
          { id: "P002", nombre: "Mouse Gamer", precio: 120000, disponible: true, imagen: "https://via.placeholder.com/50" },
          { id: "P003", nombre: "Teclado Mecánico", precio: 350000, disponible: false, imagen: "https://via.placeholder.com/50" }
      ];
  
      // Función para calcular el total a pagar
      function calcularTotal() {
          totalAmount = 0;
          productosAPI.forEach(producto => {
              if (cart[producto.id]) {
                  totalAmount += producto.precio * cart[producto.id];
              }
          });
          document.getElementById('total-pagar').innerText = '$' + totalAmount.toLocaleString() + ' COP';
      }
  
      // Función para validar el formulario de envío
      function validarFormulario() {
          const form = document.getElementById('checkout-form');
          const inputs = form.querySelectorAll('input, select');
          let valido = true;
  
          inputs.forEach(input => {
              if (!input.value.trim()) {
                  valido = false;
                  input.style.border = '1px solid red';
              } else {
                  input.style.border = '1px solid #ccc';
              }
          });
  
          return valido;
      }
  
      // Función para manejar el pago con Lightning (Zeus LN Wallet)
function pagarConLightning() {
    if (document.querySelector('input[name="delivery-method"]:checked').value === 'delivery' && !validarFormulario()) {
        alert('Por favor, completa todos los campos del formulario de envío.');
        return;
    }

    // Obtener el monto total a pagar
    const total = totalAmount; // totalAmount se calcula en la función calcularTotal()

    // Crear una factura Lightning usando la API de Zeus LN Wallet
    fetch('https://<IP-de-tu-nodo-Zeus>/lnurl/generate-invoice', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer tu-token-de-acceso' // Reemplaza con tu token de acceso de Zeus
        },
        body: JSON.stringify({
            amount: total, // Monto en satoshis
            memo: 'Pago desde @bodegascali'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.payment_request) {
            // Mostrar la factura Lightning al usuario
            alert('Escanea este código QR para pagar: ' + data.payment_request);
            // Redirigir a una página de confirmación de pago
            window.location.href = 'https://<IP-de-tu-nodo-Zeus>/invoice/' + data.payment_hash;
        } else {
            alert('Error al generar la factura Lightning.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error al conectar con el servidor de pagos.');
    });
}

// Función para manejar el pago con Bitcoin (BTC)
function pagarConBTC() {
    if (document.querySelector('input[name="delivery-method"]:checked').value === 'delivery' && !validarFormulario()) {
        alert('Por favor, completa todos los campos del formulario de envío.');
        return;
    }

    // Obtener el monto total a pagar
    const total = totalAmount; // totalAmount se calcula en la función calcularTotal()

    // Generar una dirección Bitcoin usando la API de Zeus LN Wallet
    fetch('https://<IP-de-tu-nodo-Zeus>/api/v1/new-address', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer tu-token-de-acceso' // Reemplaza con tu token de acceso de Zeus
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.address) {
            // Mostrar la dirección Bitcoin al usuario
            alert('Envía ' + (total / 100000000) + ' BTC a la siguiente dirección: ' + data.address);
            // Redirigir a una página de confirmación de pago
            window.location.href = 'https://<IP-de-tu-nodo-Zeus>/address/' + data.address;
        } else {
            alert('Error al generar la dirección Bitcoin.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error al conectar con el servidor de pagos.');
    });
}

// Asignar eventos a los botones de pago
document.getElementById('pay-lightning').addEventListener('click', pagarConLightning);
document.getElementById('pay-btc').addEventListener('click', pagarConBTC);
  
      // Función para filtrar productos en la tabla
      function filtrarProductos(query) {
          const tbody = document.getElementById("inventario");
          const filas = tbody.getElementsByTagName("tr");
  
          for (let fila of filas) {
              const nombre = fila.getElementsByTagName("td")[2].innerText.toLowerCase();
              const codigo = fila.getElementsByTagName("td")[1].innerText.toLowerCase();
              const precio = fila.getElementsByTagName("td")[4].innerText.toLowerCase();
  
              if (nombre.includes(query) || codigo.includes(query) || precio.includes(query)) {
                  fila.style.display = "";
              } else {
                  fila.style.display = "none";
              }
          }
      }
  
      // Renderizar productos dinámicamente dentro de la tabla
      function cargarInventario() {
          const tbody = document.getElementById("inventario");
          tbody.innerHTML = ""; // Limpiar la tabla antes de renderizar
  
          productosAPI.forEach(producto => {
              const fila = document.createElement("tr");
              fila.innerHTML = 
                  '<td><img src="' + producto.imagen + '" alt="' + producto.nombre + '" width="50"></td>' +
                  '<td>' + producto.id + '</td>' +
                  '<td>' + producto.nombre + '</td>' +
                  '<td>' +
                      '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="decrease">-</button>' +
                      '<span id="cantidad-' + producto.id + '">0</span>' +
                      '<button class="adjust-quantity" data-product="' + producto.id + '" data-action="increase">+</button>' +
                  '</td>' +
                  '<td>$' + producto.precio.toLocaleString() + ' COP</td>' +
                  '<td>' + (producto.disponible ? "Disponible" : "Agotado") + '</td>';
              tbody.appendChild(fila);
          });
  
          asignarEventosBotones();
      }
  
      // Asignar eventos a los botones de ajuste de cantidad
      function asignarEventosBotones() {
          document.querySelectorAll(".adjust-quantity").forEach(button => {
              button.addEventListener("click", (event) => {
                  const productId = event.target.dataset.product;
                  const action = event.target.dataset.action;
  
                  if (!cart[productId]) {
                      cart[productId] = 0;
                  }
  
                  if (action === "increase") {
                      cart[productId]++;
                      totalQuantity++;
                  } else if (action === "decrease" && cart[productId] > 0) {
                      cart[productId]--;
                      totalQuantity--;
                  }
  
                  document.getElementById('cantidad-' + productId).innerText = cart[productId];
                  calcularTotal(); // Actualizar el total a pagar
              });
          });
      }
  
      // Evento para el buscador
      document.getElementById('search-input').addEventListener('input', (event) => {
          const query = event.target.value.toLowerCase();
          filtrarProductos(query);
      });
  
      // Evento para los radio buttons de entrega
      document.querySelectorAll('input[name="delivery-method"]').forEach(radio => {
          radio.addEventListener('change', (event) => {
              const form = document.getElementById('checkout-form');
              if (event.target.value === 'delivery') {
                  form.style.display = 'block';
              } else {
                  form.style.display = 'none';
              }
          });
      });
  
      // Cargar inventario al inicio
      cargarInventario();
  </script>
      </div>
  </body>
  </html>
  `;
  
    return new Response(htmlContent, {
      headers: { 'Content-Type': 'text/html' },
    });
  }



Electrum 

addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

// ==================== CONFIGURACIÓN CORREGIDA ====================
const CONFIG = {
  business: {
    name: BUSINESS_NAME || "Mi Tienda BTC",
    currency: CURRENCY || "COP",
    logo: LOGO_URL || "https://ejemplo.com/logo.png",
    btcNetwork: BTC_NETWORK || "mainnet"
  },
  integrations: {
    lnbits: {
      endpoint: LNBITS_API_ENDPOINT,
      apiKey: LNBITS_API_KEY,
      webhookSecret: LNBITS_WEBHOOK_SECRET
    },
    electrum: {
      rpcEndpoint: ELECTRUM_RPC_ENDPOINT,
      rpcUser: ELECTRUM_RPC_USER,
      rpcPassword: ELECTRUM_RPC_PASSWORD
    }
  }
};

// Acceso directo a KV (Cloudflare Workers service worker syntax)
const INVENTORY_KV = INVENTORY_KV;
const TRANSACTIONS_KV = TRANSACTIONS_KV;

// ==================== MANEJADOR PRINCIPAL CORREGIDO ====================
async function handleRequest(request) {
  try {
    const url = new URL(request.url);
    
    // Endpoints de API
    if (url.pathname === '/api/lnbits-payment' && request.method === 'POST') {
      return handleLNbitsPayment(request);
    }
    
    if (url.pathname === '/api/bitcoin-payment' && request.method === 'POST') {
      return handleBitcoinPayment(request);
    }
    
    if (url.pathname === '/api/check-payment' && request.method === 'GET') {
      return handleCheckPayment(request);
    }
    
    if (url.pathname === '/api/webhook/lnbits' && request.method === 'POST') {
      return handleLNbitsWebhook(request);
    }
    
    // Frontend principal
    return new Response(await generateHTML(), {
      headers: { 
        'Content-Type': 'text/html',
        'X-Frame-Options': 'DENY',
        'Content-Security-Policy': "default-src 'self' https://*.lnbits.com"
      }
    });
    
  } catch (error) {
    console.error(`Error: ${error.message}`);
    return new Response(error.message, { status: 500 });
  }
}

// ==================== LÓGICA ELECTRUM MEJORADA ====================
async function electrumRPC(method, params = []) {
  try {
    const response = await fetch(CONFIG.integrations.electrum.rpcEndpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Basic ' + btoa(
          CONFIG.integrations.electrum.rpcUser + ':' + 
          CONFIG.integrations.electrum.rpcPassword
        )
      },
      body: JSON.stringify({
        jsonrpc: "2.0",
        id: "cloudflare-worker",
        method: method,
        params: params
      })
    });
    
    const data = await response.json();
    
    if (data.error) {
      throw new Error(`Electrum Error: ${JSON.stringify(data.error)}`);
    }
    
    return data.result;
    
  } catch (error) {
    throw new Error(`Electrum RPC Error: ${error.message}`);
  }
}

async function generateNewAddress() {
  return await electrumRPC("createnewaddress");
}

async function getAddressDetails(address) {
  return await electrumRPC("getaddresshistory", [address]);
}

// ==================== VERIFICACIÓN DE PAGOS MEJORADA ====================
async function handleCheckPayment(request) {
  const url = new URL(request.url);
  const address = url.searchParams.get('address');
  
  try {
    // Obtener historial de transacciones de la dirección
    const history = await getAddressDetails(address);
    const transactions = await Promise.all(
      history.map(async tx => ({
        ...tx,
        details: await electrumRPC("gettransaction", [tx.tx_hash])
      }))
    );

    // Buscar transacción en KV
    const allTransactions = await TRANSACTIONS_KV.list({prefix: 'btc-'});
    let txData = null;
    
    for (const key of allTransactions.keys) {
      const tx = await TRANSACTIONS_KV.get(key.name, 'json');
      if (tx.address === address) {
        txData = tx;
        break;
      }
    }

    if (!txData) return Response.json({ error: "Transacción no encontrada" }, { status: 404 });

    // Calcular balance confirmado
    const confirmedBalance = transactions.reduce((sum, tx) => {
      return tx.details.confirmations >= 1 ? sum + tx.value : sum;
    }, 0);

    const requiredConfirmations = CONFIG.business.btcNetwork === "mainnet" ? 3 : 1;
    const confirmations = transactions[0]?.details.confirmations || 0;
    const isConfirmed = confirmations >= requiredConfirmations;
    const paid = confirmedBalance >= txData.btcAmount;

    // Actualizar estado
    const newStatus = paid ? (isConfirmed ? 'confirmed' : 'pending_confirmations') : 'pending';
    
    await TRANSACTIONS_KV.put(txData.txId, JSON.stringify({
      ...txData,
      status: newStatus,
      confirmations,
      paidAmount: confirmedBalance
    }));

    return Response.json({
      status: newStatus,
      confirmations,
      requiredConfirmations,
      paid,
      paidAmount: confirmedBalance,
      requiredAmount: txData.btcAmount
    });

  } catch (error) {
    return Response.json({ error: "Error verificando pago: " + error.message }, { status: 500 });
  }
}

// ==================== MEJORAS EN LIGHTNING (LNBITS) ====================
async function handleLNbitsPayment(request) {
  const { amount } = await request.json();
  
  try {
    const response = await fetch(`${CONFIG.integrations.lnbits.endpoint}/api/v1/payments`, {
      method: 'POST',
      headers: {
        'X-Api-Key': CONFIG.integrations.lnbits.apiKey,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        out: false,
        amount: parseInt(amount),
        memo: CONFIG.business.name,
        webhook: `${new URL(request.url).origin}/api/webhook/lnbits`
      })
    });

    const data = await response.json();
    
    await TRANSACTIONS_KV.put(`ln-${data.payment_hash}`, JSON.stringify({
      status: 'pending',
      amount,
      invoice: data.payment_request,
      hash: data.payment_hash,
      timestamp: Date.now()
    }));

    return Response.json({ 
      invoice: data.payment_request,
      qr: `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${data.payment_request}`
    });

  } catch (error) {
    return Response.json({ error: "Error LNbits: " + error.message }, { status: 500 });
  }
}

// ==================== WEBHOOK LNBITS MEJORADO ====================
async function handleLNbitsWebhook(request) {
  try {
    const data = await request.json();
    
    // Verificar firma del webhook
    const signature = request.headers.get('X-Lnbits-Sig') || '';
    const signedContent = await crypto.subtle.digest(
      'SHA-256',
      new TextEncoder().encode(JSON.stringify(data) + CONFIG.integrations.lnbits.webhookSecret)
    );
    const expectedSig = Array.from(new Uint8Array(signedContent))
      .map(b => b.toString(16).padStart(2, '0'))
      .join('');

    if (signature !== expectedSig) {
      return new Response('Unauthorized', { status: 401 });
    }

    // Actualizar estado del pago
    if (data.paid) {
      await TRANSACTIONS_KV.put(`ln-${data.payment_hash}`, JSON.stringify({
        status: 'paid',
        amount: data.amount,
        preimage: data.preimage,
        timestamp: Date.now()
      }));

      await sendNotification(`Nuevo pago Lightning recibido: ${data.amount} sats`);
    }

    return new Response('OK');

  } catch (error) {
    return new Response('Error', { status: 500 });
  }
}

// ==================== CORRECCIONES EN EL FRONTEND ====================
async function generateHTML() {
  // ... (código anterior del frontend)
  
  // Corregir URL de pago Bitcoin
  function checkout() {
    // ...
    const method = confirm("¿Pagar con Lightning? (OK para Lightning, Cancelar para Bitcoin)") ? 'lnbits' : 'bitcoin';
    fetch(`/api/${method}-payment`, {
      // ...
    });
  }
  
  // ...
}

// ==================== FUNCIONES AUXILIARES ACTUALIZADAS ====================
async function convertToBTC(amount, currency) {
  try {
    const response = await fetch(`https://api.coinbase.com/v2/prices/BTC-${currency}/buy`);
    const data = await response.json();
    const rate = parseFloat(data.data.amount);
    const btcAmount = (amount / rate).toFixed(8);
    
    // Validar montos mínimos
    if (parseFloat(btcAmount) < 0.00001) {
      throw new Error('Monto mínimo no alcanzado (0.00001 BTC)');
    }
    
    return btcAmount;
  } catch (error) {
    throw new Error(`Error conversión: ${error.message}`);
  }
}

async function sendNotification(message) {
  if (NOTIFICATION_WEBHOOK) {
    await fetch(NOTIFICATION_WEBHOOK, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        content: `[${CONFIG.business.name}] ${message}`,
        embeds: [{
          color: 16755200, // Color naranja
          fields: [{ name: 'Notificación', value: message }]
        }]
      })
    });
  }
}


Electrum 1

addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

// ==================== CONFIGURACIÓN CORREGIDA ====================
const CONFIG = {
  business: {
    name: BUSINESS_NAME || "Mi Tienda BTC",
    currency: CURRENCY || "COP",
    logo: LOGO_URL || "https://ejemplo.com/logo.png",
    btcNetwork: BTC_NETWORK || "mainnet"
  },
  integrations: {
    lnbits: {
      endpoint: LNBITS_API_ENDPOINT,
      apiKey: LNBITS_API_KEY,
      webhookSecret: LNBITS_WEBHOOK_SECRET
    },
    electrum: {
      rpcEndpoint: ELECTRUM_RPC_ENDPOINT,
      rpcUser: ELECTRUM_RPC_USER,
      rpcPassword: ELECTRUM_RPC_PASSWORD
    }
  }
};

// Acceso directo a KV (Cloudflare Workers service worker syntax)
const INVENTORY_KV = INVENTORY_KV;
const TRANSACTIONS_KV = TRANSACTIONS_KV;

// ==================== MANEJADOR PRINCIPAL CORREGIDO ====================
async function handleRequest(request) {
  try {
    const url = new URL(request.url);
    
    // Endpoints de API
    if (url.pathname === '/api/lnbits-payment' && request.method === 'POST') {
      return handleLNbitsPayment(request);
    }
    
    if (url.pathname === '/api/bitcoin-payment' && request.method === 'POST') {
      return handleBitcoinPayment(request);
    }
    
    if (url.pathname === '/api/check-payment' && request.method === 'GET') {
      return handleCheckPayment(request);
    }
    
    if (url.pathname === '/api/webhook/lnbits' && request.method === 'POST') {
      return handleLNbitsWebhook(request);
    }
    
    // Frontend principal
    return new Response(await generateHTML(), {
      headers: { 
        'Content-Type': 'text/html',
        'X-Frame-Options': 'DENY',
        'Content-Security-Policy': "default-src 'self' https://*.lnbits.com"
      }
    });
    
  } catch (error) {
    console.error(`Error: ${error.message}`);
    return new Response(error.message, { status: 500 });
  }
}

// ==================== LÓGICA ELECTRUM MEJORADA ====================
async function electrumRPC(method, params = []) {
  try {
    const response = await fetch(CONFIG.integrations.electrum.rpcEndpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Basic ' + btoa(
          CONFIG.integrations.electrum.rpcUser + ':' + 
          CONFIG.integrations.electrum.rpcPassword
        )
      },
      body: JSON.stringify({
        jsonrpc: "2.0",
        id: "cloudflare-worker",
        method: method,
        params: params
      })
    });
    
    const data = await response.json();
    
    if (data.error) {
      throw new Error(`Electrum Error: ${JSON.stringify(data.error)}`);
    }
    
    return data.result;
    
  } catch (error) {
    throw new Error(`Electrum RPC Error: ${error.message}`);
  }
}

async function generateNewAddress() {
  return await electrumRPC("createnewaddress");
}

async function getAddressDetails(address) {
  return await electrumRPC("getaddresshistory", [address]);
}

// ==================== VERIFICACIÓN DE PAGOS MEJORADA ====================
async function handleCheckPayment(request) {
  const url = new URL(request.url);
  const address = url.searchParams.get('address');
  
  try {
    // Obtener historial de transacciones de la dirección
    const history = await getAddressDetails(address);
    const transactions = await Promise.all(
      history.map(async tx => ({
        ...tx,
        details: await electrumRPC("gettransaction", [tx.tx_hash])
      }))
    );

    // Buscar transacción en KV
    const allTransactions = await TRANSACTIONS_KV.list({prefix: 'btc-'});
    let txData = null;
    
    for (const key of allTransactions.keys) {
      const tx = await TRANSACTIONS_KV.get(key.name, 'json');
      if (tx.address === address) {
        txData = tx;
        break;
      }
    }

    if (!txData) return Response.json({ error: "Transacción no encontrada" }, { status: 404 });

    // Calcular balance confirmado
    const confirmedBalance = transactions.reduce((sum, tx) => {
      return tx.details.confirmations >= 1 ? sum + tx.value : sum;
    }, 0);

    const requiredConfirmations = CONFIG.business.btcNetwork === "mainnet" ? 3 : 1;
    const confirmations = transactions[0]?.details.confirmations || 0;
    const isConfirmed = confirmations >= requiredConfirmations;
    const paid = confirmedBalance >= txData.btcAmount;

    // Actualizar estado
    const newStatus = paid ? (isConfirmed ? 'confirmed' : 'pending_confirmations') : 'pending';
    
    await TRANSACTIONS_KV.put(txData.txId, JSON.stringify({
      ...txData,
      status: newStatus,
      confirmations,
      paidAmount: confirmedBalance
    }));

    return Response.json({
      status: newStatus,
      confirmations,
      requiredConfirmations,
      paid,
      paidAmount: confirmedBalance,
      requiredAmount: txData.btcAmount
    });

  } catch (error) {
    return Response.json({ error: "Error verificando pago: " + error.message }, { status: 500 });
  }
}

// ==================== MEJORAS EN LIGHTNING (LNBITS) ====================
async function handleLNbitsPayment(request) {
  const { amount } = await request.json();
  
  try {
    const response = await fetch(`${CONFIG.integrations.lnbits.endpoint}/api/v1/payments`, {
      method: 'POST',
      headers: {
        'X-Api-Key': CONFIG.integrations.lnbits.apiKey,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        out: false,
        amount: parseInt(amount),
        memo: CONFIG.business.name,
        webhook: `${new URL(request.url).origin}/api/webhook/lnbits`
      })
    });

    const data = await response.json();
    
    await TRANSACTIONS_KV.put(`ln-${data.payment_hash}`, JSON.stringify({
      status: 'pending',
      amount,
      invoice: data.payment_request,
      hash: data.payment_hash,
      timestamp: Date.now()
    }));

    return Response.json({ 
      invoice: data.payment_request,
      qr: `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${data.payment_request}`
    });

  } catch (error) {
    return Response.json({ error: "Error LNbits: " + error.message }, { status: 500 });
  }
}

// ==================== WEBHOOK LNBITS MEJORADO ====================
async function handleLNbitsWebhook(request) {
  try {
    const data = await request.json();
    
    // Verificar firma del webhook
    const signature = request.headers.get('X-Lnbits-Sig') || '';
    const signedContent = await crypto.subtle.digest(
      'SHA-256',
      new TextEncoder().encode(JSON.stringify(data) + CONFIG.integrations.lnbits.webhookSecret)
    );
    const expectedSig = Array.from(new Uint8Array(signedContent))
      .map(b => b.toString(16).padStart(2, '0'))
      .join('');

    if (signature !== expectedSig) {
      return new Response('Unauthorized', { status: 401 });
    }

    // Actualizar estado del pago
    if (data.paid) {
      await TRANSACTIONS_KV.put(`ln-${data.payment_hash}`, JSON.stringify({
        status: 'paid',
        amount: data.amount,
        preimage: data.preimage,
        timestamp: Date.now()
      }));

      await sendNotification(`Nuevo pago Lightning recibido: ${data.amount} sats`);
    }

    return new Response('OK');

  } catch (error) {
    return new Response('Error', { status: 500 });
  }
}

// ==================== CORRECCIONES EN EL FRONTEND ====================
async function generateHTML() {
  // ... (código anterior del frontend)
  
  // Corregir URL de pago Bitcoin
  function checkout() {
    // ...
    const method = confirm("¿Pagar con Lightning? (OK para Lightning, Cancelar para Bitcoin)") ? 'lnbits' : 'bitcoin';
    fetch(`/api/${method}-payment`, {
      // ...
    });
  }
  
  // ...
}

// ==================== FUNCIONES AUXILIARES ACTUALIZADAS ====================
async function convertToBTC(amount, currency) {
  try {
    const response = await fetch(`https://api.coinbase.com/v2/prices/BTC-${currency}/buy`);
    const data = await response.json();
    const rate = parseFloat(data.data.amount);
    const btcAmount = (amount / rate).toFixed(8);
    
    // Validar montos mínimos
    if (parseFloat(btcAmount) < 0.00001) {
      throw new Error('Monto mínimo no alcanzado (0.00001 BTC)');
    }
    
    return btcAmount;
  } catch (error) {
    throw new Error(`Error conversión: ${error.message}`);
  }
}

async function sendNotification(message) {
  if (NOTIFICATION_WEBHOOK) {
    await fetch(NOTIFICATION_WEBHOOK, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        content: `[${CONFIG.business.name}] ${message}`,
        embeds: [{
          color: 16755200, // Color naranja
          fields: [{ name: 'Notificación', value: message }]
        }]
      })
    });
  }
}


btc-payment-app/
├── .cloudflare/                  # Configuración avanzada de Cloudflare
│   ├── headers.toml              # Reglas de seguridad globales
│   ├── rate-limiting.json        # Políticas de limitación de peticiones
│   └── cache-rules.js            # Reglas de caché programáticas
├── .devcontainer/                # Configuración para GitHub Codespaces
│   ├── devcontainer.json
│   ├── Dockerfile
│   └── post-create.sh
├── .github/
│   ├── workflows/                # CI/CD Pipelines
│   │   ├── deploy-pages.yml
│   │   ├── deploy-workers.yml
│   │   └── security-scan.yml
│   ├── ISSUE_TEMPLATE/           # Plantillas de GitHub
│   │   ├── bug-report.md
│   │   └── feature-request.md
│   └── dependabot.yml            # Actualizaciones automáticas
├── public/                       # Frontend estático (Cloudflare Pages)
│   ├── index.html
│   ├── assets/
│   │   ├── css/
│   │   │   └── main.css
│   │   └── images/
│   │       ├── logo.png
│   │       └── favicon.ico
│   └── robots.txt
├── src/                          # Aplicación React
│   ├── app/
│   │   ├── layout/               # Componentes estructurales
│   │   │   ├── Header.jsx
│   │   │   └── Footer.jsx
│   │   └── payments/             # Lógica de pagos
│   │       ├── BitcoinCheckout.jsx
│   │       ├── LightningCheckout.jsx
│   │       └── PaymentStatus.jsx
│   ├── core/
│   │   ├── hooks/                # Hooks personalizados
│   │   │   ├── useElectrum.js
│   │   │   ├── useLNbits.js
│   │   │   └── usePayment.js
│   │   └── context/              # Estado global
│   │       └── PaymentProvider.jsx
│   ├── services/                 # Conexiones externas
│   │   ├── electrum.client.js
│   │   └── lnbits.client.js
│   ├── utils/                    # Funciones utilitarias
│   │   ├── currency.js
│   │   ├── security.js
│   │   └── validation.js
│   └── main.jsx                  # Punto de entrada de React
├── worker/                       # Backend (Cloudflare Workers)
│   ├── api/
│   │   ├── v1/                  # Versión 1 de la API
│   │   │   ├── bitcoin.js
│   │   │   └── lightning.js
│   │   └── webhooks/            # Manejadores de webhooks
│   │       └── lnbits.js
│   ├── lib/                     # Bibliotecas compartidas
│   │   ├── auth.js
│   │   ├── crypto.js
│   │   └── logger.js
│   ├── models/                  # Modelos de datos
│   │   ├── Transaction.js
│   │   └── Invoice.js
│   └── index.js                 # Router principal
├── tests/
│   ├── unit/                    # Pruebas unitarias
│   │   ├── services.test.js
│   │   └── utils.test.js
│   └── load/                    # Pruebas de carga
│       └── payments.test.js
├── scripts/                     # Scripts personalizados
│   ├── setup-environment.js
│   └── migrate-kv.js
├── docs/                        # Documentación
│   ├── API.md
│   └── ARCHITECTURE.md
├── .env.example                 # Variables de entorno de ejemplo
├── .gitignore
├── wrangler.toml                # Configuración de Cloudflare
├── package.json
├── package-lock.json
├── LICENSE                      # Licencia MIT
├── SECURITY.md                  # Política de seguridad
├── CODE_OF_CONDUCT.md           # Código de conducta
└── README.md                    # Documentación principal